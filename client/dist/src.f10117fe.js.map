{"version":3,"sources":["node_modules/colyseus.js/lib/legacy.js","node_modules/httpie/dist/httpie.esm.js","node_modules/notepack.io/browser/decode.js","node_modules/notepack.io/browser/encode.js","node_modules/colyseus.js/lib/msgpack.js","node_modules/strong-events/lib/index.js","node_modules/@gamestdio/websocket/lib/backoff.js","node_modules/@gamestdio/websocket/lib/index.js","node_modules/colyseus.js/lib/Connection.js","node_modules/colyseus.js/lib/serializer/Serializer.js","node_modules/colyseus.js/lib/Protocol.js","node_modules/colyseus.js/lib/Room.js","node_modules/colyseus.js/lib/Storage.js","node_modules/colyseus.js/lib/Auth.js","node_modules/colyseus.js/lib/Push.js","node_modules/colyseus.js/lib/Client.js","node_modules/@gamestdio/state-listener/lib/compare.js","node_modules/@gamestdio/state-listener/lib/StateContainer.js","node_modules/@gamestdio/state-listener/lib/index.js","node_modules/fossil-delta/fossil-delta.js","node_modules/colyseus.js/lib/serializer/FossilDeltaSerializer.js","node_modules/@colyseus/schema/lib/spec.js","node_modules/@colyseus/schema/lib/encoding/encode.js","node_modules/@colyseus/schema/lib/encoding/decode.js","node_modules/@colyseus/schema/lib/types/ArraySchema.js","node_modules/@colyseus/schema/lib/types/MapSchema.js","node_modules/@colyseus/schema/lib/ChangeTree.js","node_modules/@colyseus/schema/lib/Schema.js","node_modules/@colyseus/schema/lib/annotations.js","node_modules/@colyseus/schema/lib/Reflection.js","node_modules/@colyseus/schema/lib/index.js","node_modules/colyseus.js/lib/serializer/SchemaSerializer.js","node_modules/colyseus.js/lib/index.js","src/index.ts","../../../../../usr/local/lib/node_modules/parcel-bundler/src/builtins/hmr-runtime.js"],"names":["ArrayBuffer","isView","a","buffer","apply","src","tar","headers","statusMessage","statusText","statusCode","status","data","response","send","method","uri","opts","Promise","res","rej","k","str","tmp","arr","req","XMLHttpRequest","timeout","ontimeout","onerror","err","type","open","onload","getAllResponseHeaders","trim","split","shift","toLowerCase","join","indexOf","JSON","parse","reviver","body","test","constructor","stringify","setRequestHeader","get","bind","post","patch","del","put","__importDefault","mod","__esModule","Object","defineProperty","exports","value","decode_1","require","encode_1","decode","default","encode","createBackoff","backoff","exponential","attempt","delay","Math","floor","random","pow","fibonacci","current","prev","index","next","options","Backoff","func","attempts","initialDelay","prototype","setTimeout","onReady","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","key","Constructor","protoProps","staticProps","_classCallCheck","instance","TypeError","WebSocketImpl","WebSocket","WebSocketClient","url","protocols","arguments","undefined","reconnectEnabled","listeners","onBackoffReady","connect","reconnect","isReconnect","binaryType","ws","onclose","onCloseCallback","onErrorCallback","onmessage","onMessageCallback","onopen","onOpenCallback","number","e","code","close","reason","bufferedAmount","readyState","set","extensions","protocol","listener","CONNECTING","OPEN","CLOSING","CLOSED","__extends","extendStatics","d","b","setPrototypeOf","__proto__","Array","p","hasOwnProperty","__","create","__importStar","result","call","websocket_1","msgpack","Connection","_super","autoConnect","_this","_enqueuedCalls","event","_i","_a","_b","args","push","serializers","registerSerializer","id","serializer","getSerializer","Protocol","utf8Read","view","offset","getUint8","string","chr","end","byte","String","fromCharCode","Error","toString","utf8Length","c","l","charCodeAt","strong_events_1","Connection_1","Serializer_1","Protocol_1","Room","name","rootSchema","onJoin","createSignal","onStateChange","onMessage","onError","onLeave","state","message","console","error","removeAllListeners","endpoint","connection","invoke","warn","leave","consented","LEAVE_ROOM","ROOM_DATA","getState","listen","segments","callback","immediate","serializerId","api","removeListener","teardown","clear","previousCode","DataView","JOIN_ROOM","byteLength","handshake","bytes","from","Uint8Array","slice","JOIN_ERROR","ROOM_STATE","setState","ROOM_STATE_PATCH","encodedState","binaryPatch","storage","getStorage","cc","sys","localStorage","window","cache","setItem","getItem","removeItem","then","__awaiter","thisArg","_arguments","P","generator","resolve","reject","fulfilled","step","rejected","done","__generator","_","label","sent","t","trys","ops","f","y","g","verb","Symbol","iterator","n","v","op","pop","http","Storage_1","TOKEN_STORAGE","Platform","Auth","_id","username","displayName","avatarUrl","isAnonymous","email","lang","location","timezone","metadata","devices","facebookId","twitterId","googleId","gameCenterId","steamId","friendIds","blockedUserIds","createdAt","updatedAt","token","replace","login","queryParams","attr","assign","hasToken","request","registerPingService","save","getFriends","getOnlineFriends","getFriendRequests","sendFriendRequest","friendId","userId","acceptFriendRequest","declineFriendRequest","blockUser","unblockUser","query","name_1","queryString","logout","unregisterPingService","keepOnlineInterval","setInterval","clearInterval","Push","register","check","registerServiceWorker","requestNotificationPermission","navigator","serviceWorker","permission","requestPermission","httpie_1","Room_1","Auth_1","Push_1","MatchMakeError","Client","auth","joinOrCreate","roomName","createMatchMakeRequest","joinById","roomId","sessionId","getAvailableRooms","room","createRoom","buildEndpoint","once","remove","params","processId","state_listener_1","fossilDelta","FossilDeltaSerializer","StateContainer","previousState","schema_1","SchemaSerializer","rawState","patches","reflection","Reflection","Client_1","FossilDeltaSerializer_1","SchemaSerializer_1","Schema","OVERLAY_ID","OldModule","module","bundle","Module","moduleName","hot","hotData","_acceptCallbacks","_disposeCallbacks","accept","fn","dispose","checkedAssets","assetsToAccept","parent","isParcelRequire","hostname","handled","assets","forEach","asset","isNew","didAccept","hmrAcceptCheck","global","parcelRequire","every","generated","js","hmrApply","hmrAcceptRun","reload","log","removeErrorOverlay","stack","overlay","createErrorOverlay","document","appendChild","getElementById","createElement","stackTrace","innerText","innerHTML","getParents","modules","parents","dep","isArray","concat","Function","deps","cached","some","cb"],"mappings":"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AJ,CAASQ,GAAT;AACA,GA9CM,CAAP;AA+CA;;AAEM,IAAI2B,GAAG,GAAGnC,IAAI,CAACoC,IAAL,CAAUpC,IAAV,EAAgB,KAAhB,CAAV;;AACA,IAAIqC,IAAI,GAAGrC,IAAI,CAACoC,IAAL,CAAUpC,IAAV,EAAgB,MAAhB,CAAX;;AACA,IAAIsC,KAAK,GAAGtC,IAAI,CAACoC,IAAL,CAAUpC,IAAV,EAAgB,OAAhB,CAAZ;;AACA,IAAIuC,GAAG,GAAGvC,IAAI,CAACoC,IAAL,CAAUpC,IAAV,EAAgB,QAAhB,CAAV;;AACA,IAAIwC,GAAG,GAAGxC,IAAI,CAACoC,IAAL,CAAUpC,IAAV,EAAgB,KAAhB,CAAV;;;AC7DP;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACzRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjTA;;AACA,IAAIyC,eAAe,GAAI,QAAQ,KAAKA,eAAd,IAAkC,UAAUC,GAAV,EAAe;AACnE,SAAQA,GAAG,IAAIA,GAAG,CAACC,UAAZ,GAA0BD,GAA1B,GAAgC;AAAE,eAAWA;AAAb,GAAvC;AACH,CAFD;;AAGAE,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAAEC,EAAAA,KAAK,EAAE;AAAT,CAA7C;;AACA,IAAIC,QAAQ,GA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AACD,WAAO,KAAKtH,QAAL,GAAgB,GAAhB,GAAsBoJ,IAAI,CAACM,SAA3B,GAAuC,GAAvC,GAA6CN,IAAI,CAACH,MAAlD,GAA2D,GAA3D,GAAiEQ,MAAM,CAACrU,IAAP,CAAY,GAAZ,CAAxE;AACH,GAVD;;AAWA,SAAOuT,MAAP;AACH,CAjI2B,EAA5B;;AAkIAlS,OAAO,CAACkS,MAAR,GAAiBA,MAAjB;;ACnMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC3HA;AACA;AACA;AACA;AACA;;ACJA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AClcA;;AACA,IAAInM,YAAY,GAAI,QAAQ,KAAKA,YAAd,IAA+B,UAAUnG,GAAV,EAAe;AAC7D,MAAIA,GAAG,IAAIA,GAAG,CAACC,UAAf,EAA2B,OAAOD,GAAP;AAC3B,MAAIoG,MAAM,GAAG,EAAb;AACA,MAAIpG,GAAG,IAAI,IAAX,EAAiB,KAAK,IAAInC,CAAT,IAAcmC,GAAd,EAAmB,IAAIE,MAAM,CAAC8F,cAAP,CAAsBK,IAAtB,CAA2BrG,GAA3B,EAAgCnC,CAAhC,CAAJ,EAAwCuI,MAAM,CAACvI,CAAD,CAAN,GAAYmC,GAAG,CAACnC,CAAD,CAAf;AAC5EuI,EAAAA,MAAM,CAAC,SAAD,CAAN,GAAoBpG,GAApB;AACA,SAAOoG,MAAP;AACH,CAND;;AAOAlG,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;AAAEC,EAAAA,KAAK,EAAE;AAAT,CAA7C;;AACA,IAAIiT,gBAAgB,GAAG/S,OAAO,CAAC,2BAAD,CAA9B;;AACA,IAAIgT,WAAW,GAAGpN,YAAY,CAAC5F,OAAO,CAAC,cAAD,CAAR,CAA9B;;AACA,IAAIgG,OAAO,GAAGJ,YAAY,CAAC5F,OAAO,CAAC,YAAD,CAAR,CAA1B;;AACA,IAAIiT,qBAAqB;AAAG;AAAe,YAAY;AACnD,WAASA,qBAAT,GAAiC;AAC7B,SAAK/I,GAAL,GAAW,IAAI6I,gBAAgB,CAACG,cAArB,CAAoC,EAApC,CAAX;AACH;;AACDD,EAAAA,qBAAqB,CAACzR,SAAtB,CAAgCoI,QAAhC,GAA2C,YAAY;AACnD,WAAO,KAAKM,GAAL,CAASnB,KAAhB;AACH,GAFD;;AAGAkK,EAAAA,qBAAqB,CAACzR,SAAtB,CAAgCyJ,QAAhC,GAA2C,UAAUE,YAAV,EAAwB;AAC/D,SAAKgI,aAAL,GAAqB,IAAItI,UAAJ,CAAeM,YAAf,CAArB;AACA,SAAKjB,GAAL,CAASzF,GAAT,CAAauB,OAAO,CAAC9F,MAAR,CAAe,KAAKiT,aAApB,CAAb;AACH,GAHD;;AAIAF,EAAAA,qBAAqB,CAACzR,SAAtB,CAAgCnC,KAAhC,GAAwC,UAAU+L,WAAV,EAAuB;AAC3D;AACA,SAAK+H,aAAL,GAAqB,IAAItI,UAAJ,CAAemI,WAAW,CAAC3W,KAAZ,CAAkB,KAAK8W,aAAvB,EAAsC/H,WAAtC,CAAf,CAArB,CAF2D,CAG3D;;AACA,SAAKlB,GAAL,CAASzF,GAAT,CAAauB,OAAO,CAAC9F,MAAR,CAAe,KAAKiT,aAApB,CAAb;AACH,GALD;;AAMAF,EAAAA,qBAAqB,CAACzR,SAAtB,CAAgC4I,QAAhC,GAA2C,YAAY;AACnD,SAAKF,GAAL,CAASf,kBAAT;AACH,GAFD;;AAGA,SAAO8J,qBAAP;AACH,CArB0C,EAA3C;;AAsBApT,OAAO,CAACoT,qBAAR,GAAgCA,qBAAhC;;AClCA;AACA;AACA;AACA;AACA;AACA;AACA;;ACNA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvRA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACjPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC5EA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACnqBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AClMA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;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","file":"src.f10117fe.js","sourceRoot":"..","sourcesContent":["//\n// Polyfills for legacy environments\n//\n/*\n * Support Android 4.4.x\n */\nif (!ArrayBuffer.isView) {\n    ArrayBuffer.isView = function (a) {\n        return a !== null && typeof (a) === 'object' && a.buffer instanceof ArrayBuffer;\n    };\n}\n","function apply(src, tar) {\n\ttar.headers = src.headers || {};\n\ttar.statusMessage = src.statusText;\n\ttar.statusCode = src.status;\n\ttar.data = src.response;\n}\n\nexport function send(method, uri, opts) {\n\treturn new Promise(function (res, rej) {\n\t\topts = opts || {};\n\t\tvar k, str, tmp, arr;\n\t\tvar req = new XMLHttpRequest;\n\t\tvar headers = opts.headers || {};\n\n\t\treq.timeout = opts.timeout;\n\t\treq.ontimeout = req.onerror = function (err) {\n\t\t\terr.timeout = err.type == 'timeout';\n\t\t\trej(err);\n\t\t}\n\n\t\treq.open(method, uri);\n\n\t\treq.onload = function () {\n\t\t\tarr = req.getAllResponseHeaders().trim().split(/[\\r\\n]+/);\n\t\t\tapply(req, req); //=> req.headers\n\n\t\t\twhile (tmp = arr.shift()) {\n\t\t\t\ttmp = tmp.split(': ');\n\t\t\t\treq.headers[tmp.shift().toLowerCase()] = tmp.join(': ');\n\t\t\t}\n\n\t\t\ttmp = req.headers['content-type'];\n\t\t\tif (tmp && !!~tmp.indexOf('application/json')) {\n\t\t\t\ttry {\n\t\t\t\t\treq.data = JSON.parse(req.data, opts.reviver);\n\t\t\t\t} catch (err) {\n\t\t\t\t\tapply(req, err);\n\t\t\t\t\treturn rej(err);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t(req.status >= 400 ? rej : res)(req);\n\t\t};\n\n\t\tif ((str = opts.body) && /Array|Object/.test(str.constructor)) {\n\t\t\theaders['content-type'] = 'application/json';\n\t\t\tstr = JSON.stringify(str);\n\t\t}\n\n\t\tfor (k in headers) {\n\t\t\treq.setRequestHeader(k, headers[k]);\n\t\t}\n\n\t\treq.send(str);\n\t});\n}\n\nexport var get = send.bind(send, 'GET');\nexport var post = send.bind(send, 'POST');\nexport var patch = send.bind(send, 'PATCH');\nexport var del = send.bind(send, 'DELETE');\nexport var put = send.bind(send, 'PUT');\n","'use strict';\n\nfunction Decoder(buffer) {\n  this._offset = 0;\n  if (buffer instanceof ArrayBuffer) {\n    this._buffer = buffer;\n    this._view = new DataView(this._buffer);\n  } else if (ArrayBuffer.isView(buffer)) {\n    this._buffer = buffer.buffer;\n    this._view = new DataView(this._buffer, buffer.byteOffset, buffer.byteLength);\n  } else {\n    throw new Error('Invalid argument');\n  }\n}\n\nfunction utf8Read(view, offset, length) {\n  var string = '', chr = 0;\n  for (var i = offset, end = offset + length; i < end; i++) {\n    var byte = view.getUint8(i);\n    if ((byte & 0x80) === 0x00) {\n      string += String.fromCharCode(byte);\n      continue;\n    }\n    if ((byte & 0xe0) === 0xc0) {\n      string += String.fromCharCode(\n        ((byte & 0x1f) << 6) |\n        (view.getUint8(++i) & 0x3f)\n      );\n      continue;\n    }\n    if ((byte & 0xf0) === 0xe0) {\n      string += String.fromCharCode(\n        ((byte & 0x0f) << 12) |\n        ((view.getUint8(++i) & 0x3f) << 6) |\n        ((view.getUint8(++i) & 0x3f) << 0)\n      );\n      continue;\n    }\n    if ((byte & 0xf8) === 0xf0) {\n      chr = ((byte & 0x07) << 18) |\n        ((view.getUint8(++i) & 0x3f) << 12) |\n        ((view.getUint8(++i) & 0x3f) << 6) |\n        ((view.getUint8(++i) & 0x3f) << 0);\n      if (chr >= 0x010000) { // surrogate pair\n        chr -= 0x010000;\n        string += String.fromCharCode((chr >>> 10) + 0xD800, (chr & 0x3FF) + 0xDC00);\n      } else {\n        string += String.fromCharCode(chr);\n      }\n      continue;\n    }\n    throw new Error('Invalid byte ' + byte.toString(16));\n  }\n  return string;\n}\n\nDecoder.prototype._array = function (length) {\n  var value = new Array(length);\n  for (var i = 0; i < length; i++) {\n    value[i] = this._parse();\n  }\n  return value;\n};\n\nDecoder.prototype._map = function (length) {\n  var key = '', value = {};\n  for (var i = 0; i < length; i++) {\n    key = this._parse();\n    value[key] = this._parse();\n  }\n  return value;\n};\n\nDecoder.prototype._str = function (length) {\n  var value = utf8Read(this._view, this._offset, length);\n  this._offset += length;\n  return value;\n};\n\nDecoder.prototype._bin = function (length) {\n  var value = this._buffer.slice(this._offset, this._offset + length);\n  this._offset += length;\n  return value;\n};\n\nDecoder.prototype._parse = function () {\n  var prefix = this._view.getUint8(this._offset++);\n  var value, length = 0, type = 0, hi = 0, lo = 0;\n\n  if (prefix < 0xc0) {\n    // positive fixint\n    if (prefix < 0x80) {\n      return prefix;\n    }\n    // fixmap\n    if (prefix < 0x90) {\n      return this._map(prefix & 0x0f);\n    }\n    // fixarray\n    if (prefix < 0xa0) {\n      return this._array(prefix & 0x0f);\n    }\n    // fixstr\n    return this._str(prefix & 0x1f);\n  }\n\n  // negative fixint\n  if (prefix > 0xdf) {\n    return (0xff - prefix + 1) * -1;\n  }\n\n  switch (prefix) {\n    // nil\n    case 0xc0:\n      return null;\n    // false\n    case 0xc2:\n      return false;\n    // true\n    case 0xc3:\n      return true;\n\n    // bin\n    case 0xc4:\n      length = this._view.getUint8(this._offset);\n      this._offset += 1;\n      return this._bin(length);\n    case 0xc5:\n      length = this._view.getUint16(this._offset);\n      this._offset += 2;\n      return this._bin(length);\n    case 0xc6:\n      length = this._view.getUint32(this._offset);\n      this._offset += 4;\n      return this._bin(length);\n\n    // ext\n    case 0xc7:\n      length = this._view.getUint8(this._offset);\n      type = this._view.getInt8(this._offset + 1);\n      this._offset += 2;\n      return [type, this._bin(length)];\n    case 0xc8:\n      length = this._view.getUint16(this._offset);\n      type = this._view.getInt8(this._offset + 2);\n      this._offset += 3;\n      return [type, this._bin(length)];\n    case 0xc9:\n      length = this._view.getUint32(this._offset);\n      type = this._view.getInt8(this._offset + 4);\n      this._offset += 5;\n      return [type, this._bin(length)];\n\n    // float\n    case 0xca:\n      value = this._view.getFloat32(this._offset);\n      this._offset += 4;\n      return value;\n    case 0xcb:\n      value = this._view.getFloat64(this._offset);\n      this._offset += 8;\n      return value;\n\n    // uint\n    case 0xcc:\n      value = this._view.getUint8(this._offset);\n      this._offset += 1;\n      return value;\n    case 0xcd:\n      value = this._view.getUint16(this._offset);\n      this._offset += 2;\n      return value;\n    case 0xce:\n      value = this._view.getUint32(this._offset);\n      this._offset += 4;\n      return value;\n    case 0xcf:\n      hi = this._view.getUint32(this._offset) * Math.pow(2, 32);\n      lo = this._view.getUint32(this._offset + 4);\n      this._offset += 8;\n      return hi + lo;\n\n    // int\n    case 0xd0:\n      value = this._view.getInt8(this._offset);\n      this._offset += 1;\n      return value;\n    case 0xd1:\n      value = this._view.getInt16(this._offset);\n      this._offset += 2;\n      return value;\n    case 0xd2:\n      value = this._view.getInt32(this._offset);\n      this._offset += 4;\n      return value;\n    case 0xd3:\n      hi = this._view.getInt32(this._offset) * Math.pow(2, 32);\n      lo = this._view.getUint32(this._offset + 4);\n      this._offset += 8;\n      return hi + lo;\n\n    // fixext\n    case 0xd4:\n      type = this._view.getInt8(this._offset);\n      this._offset += 1;\n      if (type === 0x00) {\n        this._offset += 1;\n        return void 0;\n      }\n      return [type, this._bin(1)];\n    case 0xd5:\n      type = this._view.getInt8(this._offset);\n      this._offset += 1;\n      return [type, this._bin(2)];\n    case 0xd6:\n      type = this._view.getInt8(this._offset);\n      this._offset += 1;\n      return [type, this._bin(4)];\n    case 0xd7:\n      type = this._view.getInt8(this._offset);\n      this._offset += 1;\n      if (type === 0x00) {\n        hi = this._view.getInt32(this._offset) * Math.pow(2, 32);\n        lo = this._view.getUint32(this._offset + 4);\n        this._offset += 8;\n        return new Date(hi + lo);\n      }\n      return [type, this._bin(8)];\n    case 0xd8:\n      type = this._view.getInt8(this._offset);\n      this._offset += 1;\n      return [type, this._bin(16)];\n\n    // str\n    case 0xd9:\n      length = this._view.getUint8(this._offset);\n      this._offset += 1;\n      return this._str(length);\n    case 0xda:\n      length = this._view.getUint16(this._offset);\n      this._offset += 2;\n      return this._str(length);\n    case 0xdb:\n      length = this._view.getUint32(this._offset);\n      this._offset += 4;\n      return this._str(length);\n\n    // array\n    case 0xdc:\n      length = this._view.getUint16(this._offset);\n      this._offset += 2;\n      return this._array(length);\n    case 0xdd:\n      length = this._view.getUint32(this._offset);\n      this._offset += 4;\n      return this._array(length);\n\n    // map\n    case 0xde:\n      length = this._view.getUint16(this._offset);\n      this._offset += 2;\n      return this._map(length);\n    case 0xdf:\n      length = this._view.getUint32(this._offset);\n      this._offset += 4;\n      return this._map(length);\n  }\n\n  throw new Error('Could not parse');\n};\n\nfunction decode(buffer) {\n  var decoder = new Decoder(buffer);\n  var value = decoder._parse();\n  if (decoder._offset !== buffer.byteLength) {\n    throw new Error((buffer.byteLength - decoder._offset) + ' trailing bytes');\n  }\n  return value;\n}\n\nmodule.exports = decode;\n","'use strict';\n\nfunction utf8Write(view, offset, str) {\n  var c = 0;\n  for (var i = 0, l = str.length; i < l; i++) {\n    c = str.charCodeAt(i);\n    if (c < 0x80) {\n      view.setUint8(offset++, c);\n    }\n    else if (c < 0x800) {\n      view.setUint8(offset++, 0xc0 | (c >> 6));\n      view.setUint8(offset++, 0x80 | (c & 0x3f));\n    }\n    else if (c < 0xd800 || c >= 0xe000) {\n      view.setUint8(offset++, 0xe0 | (c >> 12));\n      view.setUint8(offset++, 0x80 | (c >> 6) & 0x3f);\n      view.setUint8(offset++, 0x80 | (c & 0x3f));\n    }\n    else {\n      i++;\n      c = 0x10000 + (((c & 0x3ff) << 10) | (str.charCodeAt(i) & 0x3ff));\n      view.setUint8(offset++, 0xf0 | (c >> 18));\n      view.setUint8(offset++, 0x80 | (c >> 12) & 0x3f);\n      view.setUint8(offset++, 0x80 | (c >> 6) & 0x3f);\n      view.setUint8(offset++, 0x80 | (c & 0x3f));\n    }\n  }\n}\n\nfunction utf8Length(str) {\n  var c = 0, length = 0;\n  for (var i = 0, l = str.length; i < l; i++) {\n    c = str.charCodeAt(i);\n    if (c < 0x80) {\n      length += 1;\n    }\n    else if (c < 0x800) {\n      length += 2;\n    }\n    else if (c < 0xd800 || c >= 0xe000) {\n      length += 3;\n    }\n    else {\n      i++;\n      length += 4;\n    }\n  }\n  return length;\n}\n\nfunction _encode(bytes, defers, value) {\n  var type = typeof value, i = 0, l = 0, hi = 0, lo = 0, length = 0, size = 0;\n\n  if (type === 'string') {\n    length = utf8Length(value);\n\n    // fixstr\n    if (length < 0x20) {\n      bytes.push(length | 0xa0);\n      size = 1;\n    }\n    // str 8\n    else if (length < 0x100) {\n      bytes.push(0xd9, length);\n      size = 2;\n    }\n    // str 16\n    else if (length < 0x10000) {\n      bytes.push(0xda, length >> 8, length);\n      size = 3;\n    }\n    // str 32\n    else if (length < 0x100000000) {\n      bytes.push(0xdb, length >> 24, length >> 16, length >> 8, length);\n      size = 5;\n    } else {\n      throw new Error('String too long');\n    }\n    defers.push({ _str: value, _length: length, _offset: bytes.length });\n    return size + length;\n  }\n  if (type === 'number') {\n    // TODO: encode to float 32?\n\n    // float 64\n    if (Math.floor(value) !== value || !isFinite(value)) {\n      bytes.push(0xcb);\n      defers.push({ _float: value, _length: 8, _offset: bytes.length });\n      return 9;\n    }\n\n    if (value >= 0) {\n      // positive fixnum\n      if (value < 0x80) {\n        bytes.push(value);\n        return 1;\n      }\n      // uint 8\n      if (value < 0x100) {\n        bytes.push(0xcc, value);\n        return 2;\n      }\n      // uint 16\n      if (value < 0x10000) {\n        bytes.push(0xcd, value >> 8, value);\n        return 3;\n      }\n      // uint 32\n      if (value < 0x100000000) {\n        bytes.push(0xce, value >> 24, value >> 16, value >> 8, value);\n        return 5;\n      }\n      // uint 64\n      hi = (value / Math.pow(2, 32)) >> 0;\n      lo = value >>> 0;\n      bytes.push(0xcf, hi >> 24, hi >> 16, hi >> 8, hi, lo >> 24, lo >> 16, lo >> 8, lo);\n      return 9;\n    } else {\n      // negative fixnum\n      if (value >= -0x20) {\n        bytes.push(value);\n        return 1;\n      }\n      // int 8\n      if (value >= -0x80) {\n        bytes.push(0xd0, value);\n        return 2;\n      }\n      // int 16\n      if (value >= -0x8000) {\n        bytes.push(0xd1, value >> 8, value);\n        return 3;\n      }\n      // int 32\n      if (value >= -0x80000000) {\n        bytes.push(0xd2, value >> 24, value >> 16, value >> 8, value);\n        return 5;\n      }\n      // int 64\n      hi = Math.floor(value / Math.pow(2, 32));\n      lo = value >>> 0;\n      bytes.push(0xd3, hi >> 24, hi >> 16, hi >> 8, hi, lo >> 24, lo >> 16, lo >> 8, lo);\n      return 9;\n    }\n  }\n  if (type === 'object') {\n    // nil\n    if (value === null) {\n      bytes.push(0xc0);\n      return 1;\n    }\n\n    if (Array.isArray(value)) {\n      length = value.length;\n\n      // fixarray\n      if (length < 0x10) {\n        bytes.push(length | 0x90);\n        size = 1;\n      }\n      // array 16\n      else if (length < 0x10000) {\n        bytes.push(0xdc, length >> 8, length);\n        size = 3;\n      }\n      // array 32\n      else if (length < 0x100000000) {\n        bytes.push(0xdd, length >> 24, length >> 16, length >> 8, length);\n        size = 5;\n      } else {\n        throw new Error('Array too large');\n      }\n      for (i = 0; i < length; i++) {\n        size += _encode(bytes, defers, value[i]);\n      }\n      return size;\n    }\n\n    // fixext 8 / Date\n    if (value instanceof Date) {\n      var time = value.getTime();\n      hi = Math.floor(time / Math.pow(2, 32));\n      lo = time >>> 0;\n      bytes.push(0xd7, 0, hi >> 24, hi >> 16, hi >> 8, hi, lo >> 24, lo >> 16, lo >> 8, lo);\n      return 10;\n    }\n\n    if (value instanceof ArrayBuffer) {\n      length = value.byteLength;\n\n      // bin 8\n      if (length < 0x100) {\n        bytes.push(0xc4, length);\n        size = 2;\n      } else\n      // bin 16\n      if (length < 0x10000) {\n        bytes.push(0xc5, length >> 8, length);\n        size = 3;\n      } else\n      // bin 32\n      if (length < 0x100000000) {\n        bytes.push(0xc6, length >> 24, length >> 16, length >> 8, length);\n        size = 5;\n      } else {\n        throw new Error('Buffer too large');\n      }\n      defers.push({ _bin: value, _length: length, _offset: bytes.length });\n      return size + length;\n    }\n\n    if (typeof value.toJSON === 'function') {\n      return _encode(bytes, defers, value.toJSON());\n    }\n\n    var keys = [], key = '';\n\n    var allKeys = Object.keys(value);\n    for (i = 0, l = allKeys.length; i < l; i++) {\n      key = allKeys[i];\n      if (typeof value[key] !== 'function') {\n        keys.push(key);\n      }\n    }\n    length = keys.length;\n\n    // fixmap\n    if (length < 0x10) {\n      bytes.push(length | 0x80);\n      size = 1;\n    }\n    // map 16\n    else if (length < 0x10000) {\n      bytes.push(0xde, length >> 8, length);\n      size = 3;\n    }\n    // map 32\n    else if (length < 0x100000000) {\n      bytes.push(0xdf, length >> 24, length >> 16, length >> 8, length);\n      size = 5;\n    } else {\n      throw new Error('Object too large');\n    }\n\n    for (i = 0; i < length; i++) {\n      key = keys[i];\n      size += _encode(bytes, defers, key);\n      size += _encode(bytes, defers, value[key]);\n    }\n    return size;\n  }\n  // false/true\n  if (type === 'boolean') {\n    bytes.push(value ? 0xc3 : 0xc2);\n    return 1;\n  }\n  // fixext 1 / undefined\n  if (type === 'undefined') {\n    bytes.push(0xd4, 0, 0);\n    return 3;\n  }\n  throw new Error('Could not encode');\n}\n\nfunction encode(value) {\n  var bytes = [];\n  var defers = [];\n  var size = _encode(bytes, defers, value);\n  var buf = new ArrayBuffer(size);\n  var view = new DataView(buf);\n\n  var deferIndex = 0;\n  var deferWritten = 0;\n  var nextOffset = -1;\n  if (defers.length > 0) {\n    nextOffset = defers[0]._offset;\n  }\n\n  var defer, deferLength = 0, offset = 0;\n  for (var i = 0, l = bytes.length; i < l; i++) {\n    view.setUint8(deferWritten + i, bytes[i]);\n    if (i + 1 !== nextOffset) { continue; }\n    defer = defers[deferIndex];\n    deferLength = defer._length;\n    offset = deferWritten + nextOffset;\n    if (defer._bin) {\n      var bin = new Uint8Array(defer._bin);\n      for (var j = 0; j < deferLength; j++) {\n        view.setUint8(offset + j, bin[j]);\n      }\n    } else if (defer._str) {\n      utf8Write(view, offset, defer._str);\n    } else if (defer._float !== undefined) {\n      view.setFloat64(offset, defer._float);\n    }\n    deferIndex++;\n    deferWritten += deferLength;\n    if (defers[deferIndex]) {\n      nextOffset = defers[deferIndex]._offset;\n    }\n  }\n  return buf;\n}\n\nmodule.exports = encode;\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar decode_1 = __importDefault(require(\"notepack.io/browser/decode\"));\nvar encode_1 = __importDefault(require(\"notepack.io/browser/encode\"));\nexports.decode = decode_1.default;\nexports.encode = encode_1.default;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar EventEmitter = /** @class */ (function () {\n    function EventEmitter() {\n        this.handlers = [];\n    }\n    EventEmitter.prototype.register = function (cb, once) {\n        if (once === void 0) { once = false; }\n        this.handlers.push(cb);\n        return this;\n    };\n    EventEmitter.prototype.invoke = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        this.handlers.forEach(function (handler) { return handler.apply(void 0, args); });\n    };\n    EventEmitter.prototype.invokeAsync = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        return Promise.all(this.handlers.map(function (handler) { return handler.apply(void 0, args); }));\n    };\n    EventEmitter.prototype.remove = function (cb) {\n        var index = this.handlers.indexOf(cb);\n        this.handlers[index] = this.handlers[this.handlers.length - 1];\n        this.handlers.pop();\n    };\n    EventEmitter.prototype.clear = function () {\n        this.handlers = [];\n    };\n    return EventEmitter;\n}());\nexports.EventEmitter = EventEmitter;\nfunction createSignal() {\n    var emitter = new EventEmitter();\n    function register(cb) {\n        return emitter.register(cb, this === null);\n    }\n    ;\n    register.once = function (cb) {\n        var callback = function () {\n            var args = [];\n            for (var _i = 0; _i < arguments.length; _i++) {\n                args[_i] = arguments[_i];\n            }\n            cb.apply(void 0, args);\n            emitter.remove(callback);\n        };\n        emitter.register(callback);\n    };\n    register.remove = function (cb) { return emitter.remove(cb); };\n    register.invoke = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        return emitter.invoke.apply(emitter, args);\n    };\n    register.invokeAsync = function () {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        return emitter.invokeAsync.apply(emitter, args);\n    };\n    register.clear = function () { return emitter.clear(); };\n    return register;\n}\nexports.createSignal = createSignal;\n","\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:true});exports.createBackoff=createBackoff;var backoff={exponential:function exponential(attempt,delay){return Math.floor(Math.random()*Math.pow(2,attempt)*delay);},fibonacci:function fibonacci(attempt,delay){var current=1;if(attempt>current){var prev=1,current=2;for(var index=2;index<attempt;index++){var next=prev+current;prev=current;current=next;}}return Math.floor(Math.random()*current*delay);}};function createBackoff(type,options){return new Backoff(backoff[type],options);}function Backoff(func,options){this.func=func;this.attempts=0;this.delay=typeof options.initialDelay!==\"undefined\"?options.initialDelay:100;}Backoff.prototype.backoff=function(){setTimeout(this.onReady,this.func(++this.attempts,this.delay));};","'use strict';Object.defineProperty(exports,\"__esModule\",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if(\"value\"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError(\"Cannot call a class as a function\");}}var createBackoff=require('./backoff').createBackoff;var WebSocketImpl=typeof WebSocket!==\"undefined\"?WebSocket:require('ws');var WebSocketClient=function(){/**\n   * @param url DOMString The URL to which to connect; this should be the URL to which the WebSocket server will respond.\n   * @param protocols DOMString|DOMString[] Either a single protocol string or an array of protocol strings. These strings are used to indicate sub-protocols, so that a single server can implement multiple WebSocket sub-protocols (for example, you might want one server to be able to handle different types of interactions depending on the specified protocol). If you don't specify a protocol string, an empty string is assumed.\n   */function WebSocketClient(url,protocols){var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};_classCallCheck(this,WebSocketClient);this.url=url;this.protocols=protocols;this.reconnectEnabled=true;this.listeners={};this.backoff=createBackoff(options.backoff||'exponential',options);this.backoff.onReady=this.onBackoffReady.bind(this);if(typeof options.connect===\"undefined\"||options.connect){this.open();}}_createClass(WebSocketClient,[{key:'open',value:function open(){var reconnect=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;this.isReconnect=reconnect;// keep binaryType used on previous WebSocket connection\nvar binaryType=this.ws&&this.ws.binaryType;this.ws=new WebSocketImpl(this.url,this.protocols);this.ws.onclose=this.onCloseCallback.bind(this);this.ws.onerror=this.onErrorCallback.bind(this);this.ws.onmessage=this.onMessageCallback.bind(this);this.ws.onopen=this.onOpenCallback.bind(this);if(binaryType){this.ws.binaryType=binaryType;}}/**\n   * @ignore\n   */},{key:'onBackoffReady',value:function onBackoffReady(number,delay){// console.log(\"onBackoffReady\", number + ' ' + delay + 'ms');\nthis.open(true);}/**\n   * @ignore\n   */},{key:'onCloseCallback',value:function onCloseCallback(e){if(!this.isReconnect&&this.listeners['onclose']){this.listeners['onclose'].apply(null,arguments);}if(this.reconnectEnabled&&e.code<3000){this.backoff.backoff();}}/**\n   * @ignore\n   */},{key:'onErrorCallback',value:function onErrorCallback(){if(this.listeners['onerror']){this.listeners['onerror'].apply(null,arguments);}}/**\n   * @ignore\n   */},{key:'onMessageCallback',value:function onMessageCallback(){if(this.listeners['onmessage']){this.listeners['onmessage'].apply(null,arguments);}}/**\n   * @ignore\n   */},{key:'onOpenCallback',value:function onOpenCallback(){if(this.listeners['onopen']){this.listeners['onopen'].apply(null,arguments);}if(this.isReconnect&&this.listeners['onreconnect']){this.listeners['onreconnect'].apply(null,arguments);}this.isReconnect=false;}/**\n   * The number of bytes of data that have been queued using calls to send()\n   * but not yet transmitted to the network. This value does not reset to zero\n   * when the connection is closed; if you keep calling send(), this will\n   * continue to climb.\n   *\n   * @type unsigned long\n   * @readonly\n   */},{key:'close',/**\n   * Closes the WebSocket connection or connection attempt, if any. If the\n   * connection is already CLOSED, this method does nothing.\n   *\n   * @param code A numeric value indicating the status code explaining why the connection is being closed. If this parameter is not specified, a default value of 1000 (indicating a normal \"transaction complete\" closure) is assumed. See the list of status codes on the CloseEvent page for permitted values.\n   * @param reason A human-readable string explaining why the connection is closing. This string must be no longer than 123 bytes of UTF-8 text (not characters).\n   *\n   * @return void\n   */value:function close(code,reason){if(typeof code=='undefined'){code=1000;}this.reconnectEnabled=false;this.ws.close(code,reason);}/**\n   * Transmits data to the server over the WebSocket connection.\n   * @param data DOMString|ArrayBuffer|Blob\n   * @return void\n   */},{key:'send',value:function send(data){this.ws.send(data);}/**\n   * An event listener to be called when the WebSocket connection's readyState changes to CLOSED. The listener receives a CloseEvent named \"close\".\n   * @param listener EventListener\n   */},{key:'bufferedAmount',get:function get(){return this.ws.bufferedAmount;}/**\n   * The current state of the connection; this is one of the Ready state constants.\n   * @type unsigned short\n   * @readonly\n   */},{key:'readyState',get:function get(){return this.ws.readyState;}/**\n   * A string indicating the type of binary data being transmitted by the\n   * connection. This should be either \"blob\" if DOM Blob objects are being\n   * used or \"arraybuffer\" if ArrayBuffer objects are being used.\n   * @type DOMString\n   */},{key:'binaryType',get:function get(){return this.ws.binaryType;},set:function set(binaryType){this.ws.binaryType=binaryType;}/**\n   * The extensions selected by the server. This is currently only the empty\n   * string or a list of extensions as negotiated by the connection.\n   * @type DOMString\n   */},{key:'extensions',get:function get(){return this.ws.extensions;},set:function set(extensions){this.ws.extensions=extensions;}/**\n   * A string indicating the name of the sub-protocol the server selected;\n   * this will be one of the strings specified in the protocols parameter when\n   * creating the WebSocket object.\n   * @type DOMString\n   */},{key:'protocol',get:function get(){return this.ws.protocol;},set:function set(protocol){this.ws.protocol=protocol;}},{key:'onclose',set:function set(listener){this.listeners['onclose']=listener;},get:function get(){return this.listeners['onclose'];}/**\n   * An event listener to be called when an error occurs. This is a simple event named \"error\".\n   * @param listener EventListener\n   */},{key:'onerror',set:function set(listener){this.listeners['onerror']=listener;},get:function get(){return this.listeners['onerror'];}/**\n   * An event listener to be called when a message is received from the server. The listener receives a MessageEvent named \"message\".\n   * @param listener EventListener\n   */},{key:'onmessage',set:function set(listener){this.listeners['onmessage']=listener;},get:function get(){return this.listeners['onmessage'];}/**\n   * An event listener to be called when the WebSocket connection's readyState changes to OPEN; this indicates that the connection is ready to send and receive data. The event is a simple one with the name \"open\".\n   * @param listener EventListener\n   */},{key:'onopen',set:function set(listener){this.listeners['onopen']=listener;},get:function get(){return this.listeners['onopen'];}/**\n   * @param listener EventListener\n   */},{key:'onreconnect',set:function set(listener){this.listeners['onreconnect']=listener;},get:function get(){return this.listeners['onreconnect'];}}]);return WebSocketClient;}();/**\n * The connection is not yet open.\n */WebSocketClient.CONNECTING=WebSocketImpl.CONNECTING;/**\n * The connection is open and ready to communicate.\n */WebSocketClient.OPEN=WebSocketImpl.OPEN;/**\n * The connection is in the process of closing.\n */WebSocketClient.CLOSING=WebSocketImpl.CLOSING;/**\n * The connection is closed or couldn't be opened.\n */WebSocketClient.CLOSED=WebSocketImpl.CLOSED;exports.default=WebSocketClient;","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n    result[\"default\"] = mod;\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar websocket_1 = __importDefault(require(\"@gamestdio/websocket\"));\nvar msgpack = __importStar(require(\"./msgpack\"));\nvar Connection = /** @class */ (function (_super) {\n    __extends(Connection, _super);\n    function Connection(url, autoConnect) {\n        if (autoConnect === void 0) { autoConnect = true; }\n        var _this = _super.call(this, url, undefined, { connect: autoConnect }) || this;\n        _this._enqueuedCalls = [];\n        return _this;\n    }\n    Connection.prototype.onOpenCallback = function (event) {\n        _super.prototype.onOpenCallback.call(this);\n        this.binaryType = 'arraybuffer';\n        if (this._enqueuedCalls.length > 0) {\n            for (var _i = 0, _a = this._enqueuedCalls; _i < _a.length; _i++) {\n                var _b = _a[_i], method = _b[0], args = _b[1];\n                this[method].apply(this, args);\n            }\n            // clear enqueued calls.\n            this._enqueuedCalls = [];\n        }\n    };\n    Connection.prototype.send = function (data) {\n        if (this.ws.readyState === websocket_1.default.OPEN) {\n            return _super.prototype.send.call(this, msgpack.encode(data));\n        }\n        else {\n            // WebSocket not connected.\n            // Enqueue data to be sent when readyState == OPEN\n            this._enqueuedCalls.push(['send', [data]]);\n        }\n    };\n    return Connection;\n}(websocket_1.default));\nexports.Connection = Connection;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar serializers = {};\nfunction registerSerializer(id, serializer) {\n    serializers[id] = serializer;\n}\nexports.registerSerializer = registerSerializer;\nfunction getSerializer(id) {\n    return serializers[id];\n}\nexports.getSerializer = getSerializer;\n","\"use strict\";\n// Use codes between 0~127 for lesser throughput (1 byte)\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Protocol;\n(function (Protocol) {\n    // Room-related (10~19)\n    Protocol[Protocol[\"JOIN_ROOM\"] = 10] = \"JOIN_ROOM\";\n    Protocol[Protocol[\"JOIN_ERROR\"] = 11] = \"JOIN_ERROR\";\n    Protocol[Protocol[\"LEAVE_ROOM\"] = 12] = \"LEAVE_ROOM\";\n    Protocol[Protocol[\"ROOM_DATA\"] = 13] = \"ROOM_DATA\";\n    Protocol[Protocol[\"ROOM_STATE\"] = 14] = \"ROOM_STATE\";\n    Protocol[Protocol[\"ROOM_STATE_PATCH\"] = 15] = \"ROOM_STATE_PATCH\";\n})(Protocol = exports.Protocol || (exports.Protocol = {}));\nfunction utf8Read(view, offset) {\n    var length = view.getUint8(offset++);\n    var string = '', chr = 0;\n    for (var i = offset, end = offset + length; i < end; i++) {\n        var byte = view.getUint8(i);\n        if ((byte & 0x80) === 0x00) {\n            string += String.fromCharCode(byte);\n            continue;\n        }\n        if ((byte & 0xe0) === 0xc0) {\n            string += String.fromCharCode(((byte & 0x1f) << 6) |\n                (view.getUint8(++i) & 0x3f));\n            continue;\n        }\n        if ((byte & 0xf0) === 0xe0) {\n            string += String.fromCharCode(((byte & 0x0f) << 12) |\n                ((view.getUint8(++i) & 0x3f) << 6) |\n                ((view.getUint8(++i) & 0x3f) << 0));\n            continue;\n        }\n        if ((byte & 0xf8) === 0xf0) {\n            chr = ((byte & 0x07) << 18) |\n                ((view.getUint8(++i) & 0x3f) << 12) |\n                ((view.getUint8(++i) & 0x3f) << 6) |\n                ((view.getUint8(++i) & 0x3f) << 0);\n            if (chr >= 0x010000) { // surrogate pair\n                chr -= 0x010000;\n                string += String.fromCharCode((chr >>> 10) + 0xD800, (chr & 0x3FF) + 0xDC00);\n            }\n            else {\n                string += String.fromCharCode(chr);\n            }\n            continue;\n        }\n        throw new Error('Invalid byte ' + byte.toString(16));\n    }\n    return string;\n}\nexports.utf8Read = utf8Read;\n// Faster for short strings than Buffer.byteLength\nfunction utf8Length(str) {\n    if (str === void 0) { str = ''; }\n    var c = 0;\n    var length = 0;\n    for (var i = 0, l = str.length; i < l; i++) {\n        c = str.charCodeAt(i);\n        if (c < 0x80) {\n            length += 1;\n        }\n        else if (c < 0x800) {\n            length += 2;\n        }\n        else if (c < 0xd800 || c >= 0xe000) {\n            length += 3;\n        }\n        else {\n            i++;\n            length += 4;\n        }\n    }\n    return length + 1;\n}\nexports.utf8Length = utf8Length;\n","\"use strict\";\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n    result[\"default\"] = mod;\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar msgpack = __importStar(require(\"./msgpack\"));\nvar strong_events_1 = require(\"strong-events\");\nvar Connection_1 = require(\"./Connection\");\nvar Serializer_1 = require(\"./serializer/Serializer\");\nvar Protocol_1 = require(\"./Protocol\");\nvar Room = /** @class */ (function () {\n    function Room(name, rootSchema) {\n        var _this = this;\n        // Public signals\n        this.onJoin = strong_events_1.createSignal();\n        this.onStateChange = strong_events_1.createSignal();\n        this.onMessage = strong_events_1.createSignal();\n        this.onError = strong_events_1.createSignal();\n        this.onLeave = strong_events_1.createSignal();\n        this.id = null;\n        this.name = name;\n        if (rootSchema) {\n            this.serializer = new (Serializer_1.getSerializer(\"schema\"));\n            this.rootSchema = rootSchema;\n            this.serializer.state = new (rootSchema)();\n        }\n        else {\n            // TODO: remove default serializer. it should arrive only after JOIN_ROOM.\n            this.serializer = new (Serializer_1.getSerializer(\"fossil-delta\"));\n        }\n        this.onError(function (message) { return console.error(message); });\n        this.onLeave(function () { return _this.removeAllListeners(); });\n    }\n    Room.prototype.connect = function (endpoint) {\n        var _this = this;\n        this.connection = new Connection_1.Connection(endpoint, false);\n        this.connection.reconnectEnabled = false;\n        this.connection.onmessage = this.onMessageCallback.bind(this);\n        this.connection.onclose = function (e) {\n            _this.onLeave.invoke(e.code);\n        };\n        this.connection.onerror = function (e) {\n            console.warn(\"Room, onError (\" + e.code + \"): \" + e.reason);\n            _this.onError.invoke(e.reason);\n        };\n        this.connection.open();\n    };\n    Room.prototype.leave = function (consented) {\n        if (consented === void 0) { consented = true; }\n        if (this.connection) {\n            if (consented) {\n                this.connection.send([Protocol_1.Protocol.LEAVE_ROOM]);\n            }\n            else {\n                this.connection.close();\n            }\n        }\n        else {\n            this.onLeave.invoke(4000); // \"consented\" code\n        }\n    };\n    Room.prototype.send = function (data) {\n        this.connection.send([Protocol_1.Protocol.ROOM_DATA, data]);\n    };\n    Object.defineProperty(Room.prototype, \"state\", {\n        get: function () {\n            return this.serializer.getState();\n        },\n        enumerable: true,\n        configurable: true\n    });\n    // TODO: deprecate / move somewhere else\n    // this method is useful only for FossilDeltaSerializer\n    Room.prototype.listen = function (segments, callback, immediate) {\n        if (this.serializerId === \"schema\") {\n            console.error(\"'\" + this.serializerId + \"' serializer doesn't support .listen() method.\");\n            return;\n        }\n        else if (!this.serializerId) {\n            console.warn(\"room.Listen() should be called after room.onJoin has been called (DEPRECATION WARNING)\");\n        }\n        return this.serializer.api.listen(segments, callback, immediate);\n    };\n    // TODO: deprecate / move somewhere else\n    // this method is useful only for FossilDeltaSerializer\n    Room.prototype.removeListener = function (listener) {\n        return this.serializer.api.removeListener(listener);\n    };\n    Room.prototype.removeAllListeners = function () {\n        if (this.serializer) {\n            this.serializer.teardown();\n        }\n        this.onJoin.clear();\n        this.onStateChange.clear();\n        this.onMessage.clear();\n        this.onError.clear();\n        this.onLeave.clear();\n    };\n    Room.prototype.onMessageCallback = function (event) {\n        if (!this.previousCode) {\n            var view = new DataView(event.data);\n            var code = view.getUint8(0);\n            if (code === Protocol_1.Protocol.JOIN_ROOM) {\n                var offset = 1;\n                this.serializerId = Protocol_1.utf8Read(view, offset);\n                offset += Protocol_1.utf8Length(this.serializerId);\n                // get serializer implementation\n                var serializer = Serializer_1.getSerializer(this.serializerId);\n                if (!serializer) {\n                    throw new Error(\"missing serializer: \" + this.serializerId);\n                }\n                // TODO: remove this check\n                if (this.serializerId !== \"fossil-delta\" && !this.rootSchema) {\n                    this.serializer = new serializer();\n                }\n                if (view.buffer.byteLength > offset && this.serializer.handshake) {\n                    var bytes = Array.from(new Uint8Array(view.buffer.slice(offset)));\n                    this.serializer.handshake(bytes);\n                }\n                this.onJoin.invoke();\n            }\n            else if (code === Protocol_1.Protocol.JOIN_ERROR) {\n                this.onError.invoke(Protocol_1.utf8Read(view, 1));\n            }\n            else if (code === Protocol_1.Protocol.LEAVE_ROOM) {\n                this.leave();\n            }\n            else {\n                this.previousCode = code;\n            }\n        }\n        else {\n            if (this.previousCode === Protocol_1.Protocol.ROOM_STATE) {\n                // TODO: improve here!\n                this.setState(Array.from(new Uint8Array(event.data)));\n            }\n            else if (this.previousCode === Protocol_1.Protocol.ROOM_STATE_PATCH) {\n                this.patch(Array.from(new Uint8Array(event.data)));\n            }\n            else if (this.previousCode === Protocol_1.Protocol.ROOM_DATA) {\n                this.onMessage.invoke(msgpack.decode(event.data));\n            }\n            this.previousCode = undefined;\n        }\n    };\n    Room.prototype.setState = function (encodedState) {\n        this.serializer.setState(encodedState);\n        this.onStateChange.invoke(this.serializer.getState());\n    };\n    Room.prototype.patch = function (binaryPatch) {\n        this.serializer.patch(binaryPatch);\n        this.onStateChange.invoke(this.serializer.getState());\n    };\n    return Room;\n}());\nexports.Room = Room;\n","\"use strict\";\n/**\n * We do not assign 'storage' to window.localStorage immediatelly for React\n * Native compatibility. window.localStorage is not present when this module is\n * loaded.\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar storage;\nfunction getStorage() {\n    if (!storage) {\n        storage = (typeof (cc) !== 'undefined' && cc.sys && cc.sys.localStorage)\n            ? cc.sys.localStorage // compatibility with cocos creator\n            : typeof (window) !== \"undefined\" && window.localStorage //RN does have window object at this point, but localStorage is not defined\n                ? window.localStorage // regular browser environment\n                : {\n                    cache: {},\n                    setItem: function (key, value) { this.cache[key] = value; },\n                    getItem: function (key) { this.cache[key]; },\n                    removeItem: function (key) { delete this.cache[key]; },\n                };\n    }\n    return storage;\n}\nfunction setItem(key, value) {\n    getStorage().setItem(key, value);\n}\nexports.setItem = setItem;\nfunction removeItem(key) {\n    getStorage().removeItem(key);\n}\nexports.removeItem = removeItem;\nfunction getItem(key, callback) {\n    var value = getStorage().getItem(key);\n    if (typeof (Promise) === 'undefined' || // old browsers\n        !(value instanceof Promise)) {\n        // browser has synchronous return\n        callback(value);\n    }\n    else {\n        // react-native is asynchronous\n        value.then(function (id) { return callback(id); });\n    }\n}\nexports.getItem = getItem;\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n    result[\"default\"] = mod;\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar http = __importStar(require(\"httpie\"));\nvar Storage_1 = require(\"./Storage\");\nvar TOKEN_STORAGE = \"colyseus-auth-token\";\nvar Platform;\n(function (Platform) {\n    Platform[\"ios\"] = \"ios\";\n    Platform[\"android\"] = \"android\";\n})(Platform = exports.Platform || (exports.Platform = {}));\nvar Auth = /** @class */ (function () {\n    function Auth(endpoint) {\n        var _this = this;\n        this._id = undefined;\n        this.username = undefined;\n        this.displayName = undefined;\n        this.avatarUrl = undefined;\n        this.isAnonymous = undefined;\n        this.email = undefined;\n        this.lang = undefined;\n        this.location = undefined;\n        this.timezone = undefined;\n        this.metadata = undefined;\n        this.devices = undefined;\n        this.facebookId = undefined;\n        this.twitterId = undefined;\n        this.googleId = undefined;\n        this.gameCenterId = undefined;\n        this.steamId = undefined;\n        this.friendIds = undefined;\n        this.blockedUserIds = undefined;\n        this.createdAt = undefined;\n        this.updatedAt = undefined;\n        // auth token\n        this.token = undefined;\n        this.endpoint = endpoint.replace(\"ws\", \"http\");\n        Storage_1.getItem(TOKEN_STORAGE, function (token) { return _this.token = token; });\n    }\n    Object.defineProperty(Auth.prototype, \"hasToken\", {\n        get: function () {\n            return !!this.token;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Auth.prototype.login = function (options) {\n        if (options === void 0) { options = {}; }\n        return __awaiter(this, void 0, void 0, function () {\n            var queryParams, data, attr;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        queryParams = Object.assign({}, options);\n                        if (this.hasToken) {\n                            queryParams.token = this.token;\n                        }\n                        return [4 /*yield*/, this.request('post', '/auth', queryParams)];\n                    case 1:\n                        data = _a.sent();\n                        // set & cache token\n                        this.token = data.token;\n                        Storage_1.setItem(TOKEN_STORAGE, this.token);\n                        for (attr in data) {\n                            if (this.hasOwnProperty(attr)) {\n                                this[attr] = data[attr];\n                            }\n                        }\n                        this.registerPingService();\n                        return [2 /*return*/, this];\n                }\n            });\n        });\n    };\n    Auth.prototype.save = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.request('put', '/auth', {}, {\n                            username: this.username,\n                            displayName: this.displayName,\n                            avatarUrl: this.avatarUrl,\n                            lang: this.lang,\n                            location: this.location,\n                            timezone: this.timezone,\n                        })];\n                    case 1:\n                        _a.sent();\n                        return [2 /*return*/, this];\n                }\n            });\n        });\n    };\n    Auth.prototype.getFriends = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.request('get', '/friends/all')];\n                    case 1: return [2 /*return*/, (_a.sent())];\n                }\n            });\n        });\n    };\n    Auth.prototype.getOnlineFriends = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.request('get', '/friends/online')];\n                    case 1: return [2 /*return*/, (_a.sent())];\n                }\n            });\n        });\n    };\n    Auth.prototype.getFriendRequests = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.request('get', '/friends/requests')];\n                    case 1: return [2 /*return*/, (_a.sent())];\n                }\n            });\n        });\n    };\n    Auth.prototype.sendFriendRequest = function (friendId) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.request('post', '/friends/requests', { userId: friendId })];\n                    case 1: return [2 /*return*/, (_a.sent())];\n                }\n            });\n        });\n    };\n    Auth.prototype.acceptFriendRequest = function (friendId) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.request('put', '/friends/requests', { userId: friendId })];\n                    case 1: return [2 /*return*/, (_a.sent())];\n                }\n            });\n        });\n    };\n    Auth.prototype.declineFriendRequest = function (friendId) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.request('del', '/friends/requests', { userId: friendId })];\n                    case 1: return [2 /*return*/, (_a.sent())];\n                }\n            });\n        });\n    };\n    Auth.prototype.blockUser = function (friendId) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.request('post', '/friends/block', { userId: friendId })];\n                    case 1: return [2 /*return*/, (_a.sent())];\n                }\n            });\n        });\n    };\n    Auth.prototype.unblockUser = function (friendId) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.request('put', '/friends/block', { userId: friendId })];\n                    case 1: return [2 /*return*/, (_a.sent())];\n                }\n            });\n        });\n    };\n    Auth.prototype.request = function (method, segments, query, body, headers) {\n        if (query === void 0) { query = {}; }\n        if (headers === void 0) { headers = {}; }\n        return __awaiter(this, void 0, void 0, function () {\n            var queryParams, name_1, queryString, opts;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        headers['Accept'] = 'application/json';\n                        if (this.hasToken) {\n                            headers['Authorization'] = 'Bearer ' + this.token;\n                        }\n                        queryParams = [];\n                        for (name_1 in query) {\n                            queryParams.push(name_1 + \"=\" + query[name_1]);\n                        }\n                        queryString = (queryParams.length > 0)\n                            ? \"?\" + queryParams.join(\"&\")\n                            : '';\n                        opts = { headers: headers };\n                        if (body) {\n                            opts.body = body;\n                        }\n                        return [4 /*yield*/, http[method](\"\" + this.endpoint + segments + queryString, opts)];\n                    case 1: return [2 /*return*/, (_a.sent()).data];\n                }\n            });\n        });\n    };\n    Auth.prototype.logout = function () {\n        this.token = undefined;\n        Storage_1.removeItem(TOKEN_STORAGE);\n        this.unregisterPingService();\n    };\n    Auth.prototype.registerPingService = function (timeout) {\n        var _this = this;\n        if (timeout === void 0) { timeout = 15000; }\n        this.unregisterPingService();\n        this.keepOnlineInterval = setInterval(function () { return _this.request('get', '/auth'); }, timeout);\n    };\n    Auth.prototype.unregisterPingService = function () {\n        clearInterval(this.keepOnlineInterval);\n    };\n    return Auth;\n}());\nexports.Auth = Auth;\n","\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Push = /** @class */ (function () {\n    function Push(endpoint) {\n        this.endpoint = endpoint.replace(\"ws\", \"http\");\n    }\n    Push.prototype.register = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        this.check();\n                        return [4 /*yield*/, this.registerServiceWorker()];\n                    case 1:\n                        _a.sent();\n                        return [4 /*yield*/, this.requestNotificationPermission()];\n                    case 2:\n                        _a.sent();\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    ;\n    Push.prototype.registerServiceWorker = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, navigator.serviceWorker.register(this.endpoint + \"/push\")];\n                    case 1: return [2 /*return*/, _a.sent()];\n                }\n            });\n        });\n    };\n    Push.prototype.requestNotificationPermission = function () {\n        return __awaiter(this, void 0, void 0, function () {\n            var permission;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, window[\"Notification\"].requestPermission()];\n                    case 1:\n                        permission = _a.sent();\n                        // value of permission can be 'granted', 'default', 'denied'\n                        // granted: user has accepted the request\n                        // default: user has dismissed the notification permission popup by clicking on x\n                        // denied: user has denied the request.\n                        if (permission !== \"granted\") {\n                            throw new Error(\"Permission not granted for Notification\");\n                        }\n                        return [2 /*return*/];\n                }\n            });\n        });\n    };\n    Push.prototype.check = function () {\n        if (!(\"serviceWorker\" in navigator)) {\n            throw new Error(\"No Service Worker support!\");\n        }\n        if (!(\"PushManager\" in window)) {\n            throw new Error(\"No Push API Support!\");\n        }\n    };\n    return Push;\n}());\nexports.Push = Push;\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar httpie_1 = require(\"httpie\");\nvar Room_1 = require(\"./Room\");\nvar Auth_1 = require(\"./Auth\");\nvar Push_1 = require(\"./Push\");\nvar MatchMakeError = /** @class */ (function (_super) {\n    __extends(MatchMakeError, _super);\n    function MatchMakeError(message, code) {\n        var _this = _super.call(this, message) || this;\n        _this.code = code;\n        Object.setPrototypeOf(_this, MatchMakeError.prototype);\n        return _this;\n    }\n    return MatchMakeError;\n}(Error));\nexports.MatchMakeError = MatchMakeError;\nvar Client = /** @class */ (function () {\n    function Client(endpoint) {\n        this.endpoint = endpoint;\n        this.auth = new Auth_1.Auth(this.endpoint);\n        this.push = new Push_1.Push(this.endpoint);\n    }\n    Client.prototype.joinOrCreate = function (roomName, options, rootSchema) {\n        if (options === void 0) { options = {}; }\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.createMatchMakeRequest('joinOrCreate', roomName, options, rootSchema)];\n                    case 1: return [2 /*return*/, _a.sent()];\n                }\n            });\n        });\n    };\n    Client.prototype.create = function (roomName, options, rootSchema) {\n        if (options === void 0) { options = {}; }\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.createMatchMakeRequest('create', roomName, options, rootSchema)];\n                    case 1: return [2 /*return*/, _a.sent()];\n                }\n            });\n        });\n    };\n    Client.prototype.join = function (roomName, options, rootSchema) {\n        if (options === void 0) { options = {}; }\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.createMatchMakeRequest('join', roomName, options, rootSchema)];\n                    case 1: return [2 /*return*/, _a.sent()];\n                }\n            });\n        });\n    };\n    Client.prototype.joinById = function (roomId, options, rootSchema) {\n        if (options === void 0) { options = {}; }\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.createMatchMakeRequest('joinById', roomId, options, rootSchema)];\n                    case 1: return [2 /*return*/, _a.sent()];\n                }\n            });\n        });\n    };\n    Client.prototype.reconnect = function (roomId, sessionId, rootSchema) {\n        return __awaiter(this, void 0, void 0, function () {\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0: return [4 /*yield*/, this.createMatchMakeRequest('joinById', roomId, { sessionId: sessionId }, rootSchema)];\n                    case 1: return [2 /*return*/, _a.sent()];\n                }\n            });\n        });\n    };\n    Client.prototype.getAvailableRooms = function (roomName) {\n        if (roomName === void 0) { roomName = \"\"; }\n        return __awaiter(this, void 0, void 0, function () {\n            var url;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        url = this.endpoint.replace(\"ws\", \"http\") + \"/matchmake/\" + roomName;\n                        return [4 /*yield*/, httpie_1.get(url, { headers: { 'Accept': 'application/json' } })];\n                    case 1: return [2 /*return*/, (_a.sent()).data];\n                }\n            });\n        });\n    };\n    Client.prototype.createMatchMakeRequest = function (method, roomName, options, rootSchema) {\n        if (options === void 0) { options = {}; }\n        return __awaiter(this, void 0, void 0, function () {\n            var url, response, room;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        url = this.endpoint.replace(\"ws\", \"http\") + \"/matchmake/\" + method + \"/\" + roomName;\n                        // automatically forward auth token, if present\n                        if (this.auth.hasToken) {\n                            options.token = this.auth.token;\n                        }\n                        return [4 /*yield*/, httpie_1.post(url, {\n                                headers: {\n                                    'Accept': 'application/json',\n                                    'Content-Type': 'application/json'\n                                },\n                                body: JSON.stringify(options)\n                            })];\n                    case 1:\n                        response = (_a.sent()).data;\n                        if (response.error) {\n                            throw new MatchMakeError(response.error, response.code);\n                        }\n                        room = this.createRoom(roomName, rootSchema);\n                        room.id = response.room.roomId;\n                        room.sessionId = response.sessionId;\n                        room.connect(this.buildEndpoint(response.room, { sessionId: room.sessionId }));\n                        return [2 /*return*/, new Promise(function (resolve, reject) {\n                                var onError = function (message) { return reject(message); };\n                                room.onError.once(onError);\n                                room.onJoin.once(function () {\n                                    room.onError.remove(onError);\n                                    resolve(room);\n                                });\n                            })];\n                }\n            });\n        });\n    };\n    Client.prototype.createRoom = function (roomName, rootSchema) {\n        return new Room_1.Room(roomName, rootSchema);\n    };\n    Client.prototype.buildEndpoint = function (room, options) {\n        if (options === void 0) { options = {}; }\n        var params = [];\n        for (var name_1 in options) {\n            if (!options.hasOwnProperty(name_1)) {\n                continue;\n            }\n            params.push(name_1 + \"=\" + options[name_1]);\n        }\n        return this.endpoint + \"/\" + room.processId + \"/\" + room.roomId + \"?\" + params.join('&');\n    };\n    return Client;\n}());\nexports.Client = Client;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nfunction compare(tree1, tree2) {\n    var patches = [];\n    generate(tree1, tree2, patches, []);\n    return patches;\n}\nexports.compare = compare;\nfunction concat(arr, value) {\n    var newArr = arr.slice();\n    newArr.push(value);\n    return newArr;\n}\nfunction objectKeys(obj) {\n    if (Array.isArray(obj)) {\n        var keys_1 = new Array(obj.length);\n        for (var k = 0; k < keys_1.length; k++) {\n            keys_1[k] = \"\" + k;\n        }\n        return keys_1;\n    }\n    if (Object.keys) {\n        return Object.keys(obj);\n    }\n    var keys = [];\n    for (var i in obj) {\n        if (obj.hasOwnProperty(i)) {\n            keys.push(i);\n        }\n    }\n    return keys;\n}\n;\n// Dirty check if obj is different from mirror, generate patches and update mirror\nfunction generate(mirror, obj, patches, path) {\n    var newKeys = objectKeys(obj);\n    var oldKeys = objectKeys(mirror);\n    var deleted = false;\n    for (var t = oldKeys.length - 1; t >= 0; t--) {\n        var key = oldKeys[t];\n        var oldVal = mirror[key];\n        if (obj.hasOwnProperty(key) && !(obj[key] === undefined && oldVal !== undefined && Array.isArray(obj) === false)) {\n            var newVal = obj[key];\n            if (typeof oldVal == \"object\" && oldVal != null && typeof newVal == \"object\" && newVal != null) {\n                generate(oldVal, newVal, patches, concat(path, key));\n            }\n            else {\n                if (oldVal !== newVal) {\n                    patches.push({\n                        operation: \"replace\",\n                        path: concat(path, key),\n                        value: newVal,\n                        previousValue: oldVal\n                    });\n                }\n            }\n        }\n        else {\n            patches.push({ operation: \"remove\", path: concat(path, key) });\n            deleted = true; // property has been deleted\n        }\n    }\n    if (!deleted && newKeys.length == oldKeys.length) {\n        return;\n    }\n    for (var t = newKeys.length - 1; t >= 0; t--) {\n        var key = newKeys[t];\n        if (!mirror.hasOwnProperty(key) && obj[key] !== undefined) {\n            var newVal = obj[key];\n            var addPath = concat(path, key);\n            // compare deeper additions\n            if (typeof newVal == \"object\" && newVal != null) {\n                generate({}, newVal, patches, addPath);\n            }\n            patches.push({ operation: \"add\", path: addPath, value: newVal });\n        }\n    }\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar compare_1 = require(\"./compare\");\nvar StateContainer = /** @class */ (function () {\n    function StateContainer(state) {\n        this.listeners = [];\n        this.matcherPlaceholders = {\n            \":id\": /^([a-zA-Z0-9\\-_]+)$/,\n            \":number\": /^([0-9]+)$/,\n            \":string\": /^(\\w+)$/,\n            \":axis\": /^([xyz])$/,\n            \":*\": /(.*)/,\n        };\n        this.state = state;\n        this.reset();\n    }\n    StateContainer.prototype.set = function (newState) {\n        var patches = compare_1.compare(this.state, newState);\n        this.state = newState;\n        this.checkPatches(patches, this.listeners, this.defaultListener);\n        return patches;\n    };\n    StateContainer.prototype.registerPlaceholder = function (placeholder, matcher) {\n        this.matcherPlaceholders[placeholder] = matcher;\n    };\n    StateContainer.prototype.listen = function (segments, callback, immediate) {\n        var _this = this;\n        var rules;\n        if (typeof (segments) === \"function\") {\n            rules = [];\n            callback = segments;\n        }\n        else {\n            rules = segments.split(\"/\");\n        }\n        if (callback.length > 1) {\n            console.warn(\".listen() accepts only one parameter.\");\n        }\n        var listener = {\n            callback: callback,\n            rawRules: rules,\n            rules: rules.map(function (segment) {\n                if (typeof (segment) === \"string\") {\n                    // replace placeholder matchers\n                    return (segment.indexOf(\":\") === 0)\n                        ? _this.matcherPlaceholders[segment] || _this.matcherPlaceholders[\":*\"]\n                        : new RegExp(\"^\" + segment + \"$\");\n                }\n                else {\n                    return segment;\n                }\n            })\n        };\n        if (rules.length === 0) {\n            this.defaultListener = listener;\n        }\n        else {\n            this.listeners.push(listener);\n        }\n        // immediatelly try to trigger this listener.\n        if (immediate) {\n            this.checkPatches(compare_1.compare({}, this.state), [listener]);\n        }\n        return listener;\n    };\n    StateContainer.prototype.removeListener = function (listener) {\n        for (var i = this.listeners.length - 1; i >= 0; i--) {\n            if (this.listeners[i] === listener) {\n                this.listeners.splice(i, 1);\n            }\n        }\n    };\n    StateContainer.prototype.removeAllListeners = function () {\n        this.reset();\n    };\n    StateContainer.prototype.checkPatches = function (patches, listeners, defaultListener) {\n        for (var j = 0, len = listeners.length; j < len; j++) {\n            var listener = listeners[j];\n            for (var i = patches.length - 1; i >= 0; i--) {\n                var pathVariables = listener && this.getPathVariables(patches[i], listener);\n                if (pathVariables) {\n                    listener.callback({\n                        path: pathVariables,\n                        rawPath: patches[i].path,\n                        operation: patches[i].operation,\n                        value: patches[i].value\n                    });\n                    patches[i].matched = true;\n                }\n            }\n        }\n        // trigger default listener callback with each unmatched patch\n        if (defaultListener) {\n            for (var i = patches.length - 1; i >= 0; i--) {\n                if (!patches[i].matched) {\n                    defaultListener.callback(patches[i]);\n                }\n            }\n        }\n    };\n    StateContainer.prototype.getPathVariables = function (patch, listener) {\n        // skip if rules count differ from patch\n        if (patch.path.length !== listener.rules.length) {\n            return false;\n        }\n        var path = {};\n        for (var i = 0, len = listener.rules.length; i < len; i++) {\n            var matches = patch.path[i].match(listener.rules[i]);\n            if (!matches || matches.length === 0 || matches.length > 2) {\n                return false;\n            }\n            else if (listener.rawRules[i].substr(0, 1) === \":\") {\n                path[listener.rawRules[i].substr(1)] = matches[1];\n            }\n        }\n        return path;\n    };\n    StateContainer.prototype.reset = function () {\n        this.listeners = [];\n    };\n    return StateContainer;\n}());\nexports.StateContainer = StateContainer;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar StateContainer_1 = require(\"./StateContainer\");\nexports.StateContainer = StateContainer_1.StateContainer;\n","// Fossil SCM delta compression algorithm\n// ======================================\n//\n// Format:\n// http://www.fossil-scm.org/index.html/doc/tip/www/delta_format.wiki\n//\n// Algorithm:\n// http://www.fossil-scm.org/index.html/doc/tip/www/delta_encoder_algorithm.wiki\n//\n// Original implementation:\n// http://www.fossil-scm.org/index.html/artifact/d1b0598adcd650b3551f63b17dfc864e73775c3d\n//\n// LICENSE\n// -------\n//\n// Copyright 2014 Dmitry Chestnykh (JavaScript port)\n// Copyright 2007 D. Richard Hipp  (original C version)\n// All rights reserved.\n//\n// Redistribution and use in source and binary forms, with or\n// without modification, are permitted provided that the\n// following conditions are met:\n//\n//   1. Redistributions of source code must retain the above\n//      copyright notice, this list of conditions and the\n//      following disclaimer.\n//\n//   2. Redistributions in binary form must reproduce the above\n//      copyright notice, this list of conditions and the\n//      following disclaimer in the documentation and/or other\n//      materials provided with the distribution.\n//\n// THIS SOFTWARE IS PROVIDED BY THE AUTHORS ``AS IS'' AND ANY EXPRESS\n// OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\n// WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE\n// ARE DISCLAIMED. IN NO EVENT SHALL THE AUTHORS OR CONTRIBUTORS BE\n// LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR\n// CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF\n// SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR\n// BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY,\n// WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE\n// OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE,\n// EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n//\n// The views and conclusions contained in the software and documentation\n// are those of the authors and contributors and should not be interpreted\n// as representing official policies, either expressed or implied, of anybody\n// else.\n//\n(function(root, factory) {\n  if (typeof module !== 'undefined' && module.exports) module.exports = factory();\n  else root.fossilDelta = factory();\n})(this, function() {\n'use strict';\n\nvar fossilDelta = {};\n\n// Hash window width in bytes. Must be a power of two.\nvar NHASH = 16;\n\nfunction RollingHash() {\n  this.a = 0; // hash     (16-bit unsigned)\n  this.b = 0; // values   (16-bit unsigned)\n  this.i = 0; // start of the hash window (16-bit unsigned)\n  this.z = new Array(NHASH); // the values that have been hashed.\n}\n\n// Initialize the rolling hash using the first NHASH bytes of\n// z at the given position.\nRollingHash.prototype.init = function(z, pos) {\n  var a = 0, b = 0, i, x;\n  for(i = 0; i < NHASH; i++){\n    x = z[pos+i];\n    a = (a + x) & 0xffff;\n    b = (b + (NHASH-i)*x) & 0xffff;\n    this.z[i] = x;\n  }\n  this.a = a & 0xffff;\n  this.b = b & 0xffff;\n  this.i = 0;\n};\n\n// Advance the rolling hash by a single byte \"c\".\nRollingHash.prototype.next = function(c) {\n  var old = this.z[this.i];\n  this.z[this.i] = c;\n  this.i = (this.i+1)&(NHASH-1);\n  this.a = (this.a - old + c) & 0xffff;\n  this.b = (this.b - NHASH*old + this.a) & 0xffff;\n};\n\n// Return a 32-bit hash value.\nRollingHash.prototype.value = function() {\n  return ((this.a & 0xffff) | (this.b & 0xffff)<<16)>>>0;\n};\n\nvar zDigits = \"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz~\".\n                split('').map(function (x) { return x.charCodeAt(0); });\n\nvar zValue = [\n  -1, -1, -1, -1, -1, -1, -1, -1,   -1, -1, -1, -1, -1, -1, -1, -1,\n  -1, -1, -1, -1, -1, -1, -1, -1,   -1, -1, -1, -1, -1, -1, -1, -1,\n  -1, -1, -1, -1, -1, -1, -1, -1,   -1, -1, -1, -1, -1, -1, -1, -1,\n   0,  1,  2,  3,  4,  5,  6,  7,    8,  9, -1, -1, -1, -1, -1, -1,\n  -1, 10, 11, 12, 13, 14, 15, 16,   17, 18, 19, 20, 21, 22, 23, 24,\n  25, 26, 27, 28, 29, 30, 31, 32,   33, 34, 35, -1, -1, -1, -1, 36,\n  -1, 37, 38, 39, 40, 41, 42, 43,   44, 45, 46, 47, 48, 49, 50, 51,\n  52, 53, 54, 55, 56, 57, 58, 59,   60, 61, 62, -1, -1, -1, 63, -1\n];\n\n// Reader reads bytes, chars, ints from array.\nfunction Reader(array) {\n  this.a = array; // source array\n  this.pos = 0;   // current position in array\n}\n\nReader.prototype.haveBytes = function() {\n  return this.pos < this.a.length;\n};\n\nReader.prototype.getByte = function() {\n  var b = this.a[this.pos];\n  this.pos++;\n  if (this.pos > this.a.length) throw new RangeError('out of bounds');\n  return b;\n};\n\nReader.prototype.getChar = function() {\n  return String.fromCharCode(this.getByte());\n};\n\n// Read base64-encoded unsigned integer.\nReader.prototype.getInt = function(){\n  var v = 0, c;\n  while(this.haveBytes() && (c = zValue[0x7f & this.getByte()]) >= 0) {\n     v = (v<<6) + c;\n  }\n  this.pos--;\n  return v >>> 0;\n};\n\n\n// Write writes an array.\nfunction Writer() {\n  this.a = [];\n}\n\nWriter.prototype.toArray = function() {\n  return this.a;\n};\n\nWriter.prototype.putByte = function(b) {\n  this.a.push(b & 0xff);\n};\n\n// Write an ASCII character (s is a one-char string).\nWriter.prototype.putChar = function(s) {\n  this.putByte(s.charCodeAt(0));\n};\n\n// Write a base64 unsigned integer.\nWriter.prototype.putInt = function(v){\n  var i, j, zBuf = [];\n  if (v === 0) {\n    this.putChar('0');\n    return;\n  }\n  for (i = 0; v > 0; i++, v >>>= 6)\n    zBuf.push(zDigits[v&0x3f]);\n  for (j = i-1; j >= 0; j--)\n    this.putByte(zBuf[j]);\n};\n\n// Copy from array at start to end.\nWriter.prototype.putArray = function(a, start, end) {\n  for (var i = start; i < end; i++) this.a.push(a[i]);\n};\n\n// Return the number digits in the base64 representation of a positive integer.\nfunction digitCount(v){\n  var i, x;\n  for (i = 1, x = 64; v >= x; i++, x <<= 6){ /* nothing */ }\n  return i;\n}\n\n// Return a 32-bit checksum of the array.\nfunction checksum(arr) {\n  var sum0 = 0, sum1 = 0, sum2 = 0, sum3 = 0,\n      z = 0, N = arr.length;\n  //TODO measure if this unrolling is helpful.\n  while (N >= 16) {\n    sum0 = sum0 + arr[z+0] | 0;\n    sum1 = sum1 + arr[z+1] | 0;\n    sum2 = sum2 + arr[z+2] | 0;\n    sum3 = sum3 + arr[z+3] | 0;\n\n    sum0 = sum0 + arr[z+4] | 0;\n    sum1 = sum1 + arr[z+5] | 0;\n    sum2 = sum2 + arr[z+6] | 0;\n    sum3 = sum3 + arr[z+7] | 0;\n\n    sum0 = sum0 + arr[z+8] | 0;\n    sum1 = sum1 + arr[z+9] | 0;\n    sum2 = sum2 + arr[z+10] | 0;\n    sum3 = sum3 + arr[z+11] | 0;\n\n    sum0 = sum0 + arr[z+12] | 0;\n    sum1 = sum1 + arr[z+13] | 0;\n    sum2 = sum2 + arr[z+14] | 0;\n    sum3 = sum3 + arr[z+15] | 0;\n\n    z += 16;\n    N -= 16;\n  }\n  while (N >= 4) {\n    sum0 = sum0 + arr[z+0] | 0;\n    sum1 = sum1 + arr[z+1] | 0;\n    sum2 = sum2 + arr[z+2] | 0;\n    sum3 = sum3 + arr[z+3] | 0;\n    z += 4;\n    N -= 4;\n  }\n  sum3 = (((sum3 + (sum2 << 8) | 0) + (sum1 << 16) | 0) + (sum0 << 24) | 0);\n  /* jshint -W086 */\n  switch (N) {\n    case 3: sum3 = sum3 + (arr[z+2] <<  8) | 0; /* falls through */\n    case 2: sum3 = sum3 + (arr[z+1] << 16) | 0; /* falls through */\n    case 1: sum3 = sum3 + (arr[z+0] << 24) | 0; /* falls through */\n  }\n  return sum3 >>> 0;\n}\n\n// Create a new delta from src to out.\nfossilDelta.create = function(src, out) {\n  var zDelta = new Writer();\n  var lenOut = out.length;\n  var lenSrc = src.length;\n  var i, lastRead = -1;\n\n  zDelta.putInt(lenOut);\n  zDelta.putChar('\\n');\n\n  // If the source is very small, it means that we have no\n  // chance of ever doing a copy command.  Just output a single\n  // literal segment for the entire target and exit.\n  if (lenSrc <= NHASH) {\n    zDelta.putInt(lenOut);\n    zDelta.putChar(':');\n    zDelta.putArray(out, 0, lenOut);\n    zDelta.putInt(checksum(out));\n    zDelta.putChar(';');\n    return zDelta.toArray();\n  }\n\n  // Compute the hash table used to locate matching sections in the source.\n  var nHash = Math.ceil(lenSrc / NHASH);\n  var collide =  new Array(nHash);\n  var landmark = new Array(nHash);\n  for (i = 0; i < collide.length; i++) collide[i] = -1;\n  for (i = 0; i < landmark.length; i++) landmark[i] = -1;\n  var hv, h = new RollingHash();\n  for (i = 0; i < lenSrc-NHASH; i += NHASH) {\n    h.init(src, i);\n    hv = h.value() % nHash;\n    collide[i/NHASH] = landmark[hv];\n    landmark[hv] = i/NHASH;\n  }\n\n  var base = 0;\n  var iSrc, iBlock, bestCnt, bestOfst, bestLitsz;\n  while (base+NHASH<lenOut) {\n    bestOfst=0;\n    bestLitsz=0;\n    h.init(out, base);\n    i = 0; // Trying to match a landmark against zOut[base+i]\n    bestCnt = 0;\n    while(1) {\n      var limit = 250;\n      hv = h.value() % nHash;\n      iBlock = landmark[hv];\n      while (iBlock >= 0 && (limit--)>0 ) {\n        //\n        // The hash window has identified a potential match against\n        // landmark block iBlock.  But we need to investigate further.\n        //\n        // Look for a region in zOut that matches zSrc. Anchor the search\n        // at zSrc[iSrc] and zOut[base+i].  Do not include anything prior to\n        // zOut[base] or after zOut[outLen] nor anything after zSrc[srcLen].\n        //\n        // Set cnt equal to the length of the match and set ofst so that\n        // zSrc[ofst] is the first element of the match.  litsz is the number\n        // of characters between zOut[base] and the beginning of the match.\n        // sz will be the overhead (in bytes) needed to encode the copy\n        // command.  Only generate copy command if the overhead of the\n        // copy command is less than the amount of literal text to be copied.\n        //\n        var cnt, ofst, litsz;\n        var j, k, x, y;\n        var sz;\n\n        // Beginning at iSrc, match forwards as far as we can.\n        // j counts the number of characters that match.\n        iSrc = iBlock*NHASH;\n        for (j = 0, x = iSrc, y = base+i; x < lenSrc && y < lenOut; j++, x++, y++) {\n          if (src[x] !== out[y]) break;\n        }\n        j--;\n\n        // Beginning at iSrc-1, match backwards as far as we can.\n        // k counts the number of characters that match.\n        for (k = 1; k < iSrc && k <= i; k++) {\n          if (src[iSrc-k] !== out[base+i-k]) break;\n        }\n        k--;\n\n        // Compute the offset and size of the matching region.\n        ofst = iSrc-k;\n        cnt = j+k+1;\n        litsz = i-k;  // Number of bytes of literal text before the copy\n        // sz will hold the number of bytes needed to encode the \"insert\"\n        // command and the copy command, not counting the \"insert\" text.\n        sz = digitCount(i-k)+digitCount(cnt)+digitCount(ofst)+3;\n        if (cnt >= sz && cnt > bestCnt) {\n          // Remember this match only if it is the best so far and it\n          // does not increase the file size.\n          bestCnt = cnt;\n          bestOfst = iSrc-k;\n          bestLitsz = litsz;\n        }\n\n        // Check the next matching block\n        iBlock = collide[iBlock];\n      }\n\n      // We have a copy command that does not cause the delta to be larger\n      // than a literal insert.  So add the copy command to the delta.\n      if (bestCnt > 0) {\n        if (bestLitsz > 0) {\n          // Add an insert command before the copy.\n          zDelta.putInt(bestLitsz);\n          zDelta.putChar(':');\n          zDelta.putArray(out, base, base+bestLitsz);\n          base += bestLitsz;\n        }\n        base += bestCnt;\n        zDelta.putInt(bestCnt);\n        zDelta.putChar('@');\n        zDelta.putInt(bestOfst);\n        zDelta.putChar(',');\n        if (bestOfst + bestCnt -1 > lastRead) {\n          lastRead = bestOfst + bestCnt - 1;\n        }\n        bestCnt = 0;\n        break;\n      }\n\n      // If we reach this point, it means no match is found so far\n      if (base+i+NHASH >= lenOut){\n        // We have reached the end and have not found any\n        // matches.  Do an \"insert\" for everything that does not match\n        zDelta.putInt(lenOut-base);\n        zDelta.putChar(':');\n        zDelta.putArray(out, base, base+lenOut-base);\n        base = lenOut;\n        break;\n      }\n\n      // Advance the hash by one character. Keep looking for a match.\n      h.next(out[base+i+NHASH]);\n      i++;\n    }\n  }\n  // Output a final \"insert\" record to get all the text at the end of\n  // the file that does not match anything in the source.\n  if(base < lenOut) {\n    zDelta.putInt(lenOut-base);\n    zDelta.putChar(':');\n    zDelta.putArray(out, base, base+lenOut-base);\n  }\n  // Output the final checksum record.\n  zDelta.putInt(checksum(out));\n  zDelta.putChar(';');\n  return zDelta.toArray();\n};\n\n// Return the size (in bytes) of the output from applying a delta.\nfossilDelta.outputSize = function(delta){\n  var zDelta = new Reader(delta);\n  var size = zDelta.getInt();\n  if (zDelta.getChar() !== '\\n')\n    throw new Error('size integer not terminated by \\'\\\\n\\'');\n  return size;\n};\n\n// Apply a delta.\nfossilDelta.apply = function(src, delta, opts) {\n  var limit, total = 0;\n  var zDelta = new Reader(delta);\n  var lenSrc = src.length;\n  var lenDelta = delta.length;\n\n  limit = zDelta.getInt();\n  if (zDelta.getChar() !== '\\n')\n    throw new Error('size integer not terminated by \\'\\\\n\\'');\n  var zOut = new Writer();\n  while(zDelta.haveBytes()) {\n    var cnt, ofst;\n    cnt = zDelta.getInt();\n\n    switch (zDelta.getChar()) {\n      case '@':\n        ofst = zDelta.getInt();\n        if (zDelta.haveBytes() && zDelta.getChar() !== ',')\n          throw new Error('copy command not terminated by \\',\\'');\n        total += cnt;\n        if (total > limit)\n          throw new Error('copy exceeds output file size');\n        if (ofst+cnt > lenSrc)\n          throw new Error('copy extends past end of input');\n        zOut.putArray(src, ofst, ofst+cnt);\n        break;\n\n      case ':':\n        total += cnt;\n        if (total > limit)\n          throw new Error('insert command gives an output larger than predicted');\n        if (cnt > lenDelta)\n          throw new Error('insert count exceeds size of delta');\n        zOut.putArray(zDelta.a, zDelta.pos, zDelta.pos+cnt);\n        zDelta.pos += cnt;\n        break;\n\n      case ';':\n        var out = zOut.toArray();\n        if ((!opts || opts.verifyChecksum !== false) && cnt !== checksum(out))\n          throw new Error('bad checksum');\n        if (total !== limit)\n          throw new Error('generated size does not match predicted size');\n        return out;\n\n      default:\n        throw new Error('unknown delta operator');\n    }\n  }\n  throw new Error('unterminated delta');\n};\n\nreturn fossilDelta;\n\n});\n","\"use strict\";\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];\n    result[\"default\"] = mod;\n    return result;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar state_listener_1 = require(\"@gamestdio/state-listener\");\nvar fossilDelta = __importStar(require(\"fossil-delta\"));\nvar msgpack = __importStar(require(\"../msgpack\"));\nvar FossilDeltaSerializer = /** @class */ (function () {\n    function FossilDeltaSerializer() {\n        this.api = new state_listener_1.StateContainer({});\n    }\n    FossilDeltaSerializer.prototype.getState = function () {\n        return this.api.state;\n    };\n    FossilDeltaSerializer.prototype.setState = function (encodedState) {\n        this.previousState = new Uint8Array(encodedState);\n        this.api.set(msgpack.decode(this.previousState));\n    };\n    FossilDeltaSerializer.prototype.patch = function (binaryPatch) {\n        // apply patch\n        this.previousState = new Uint8Array(fossilDelta.apply(this.previousState, binaryPatch));\n        // trigger update callbacks\n        this.api.set(msgpack.decode(this.previousState));\n    };\n    FossilDeltaSerializer.prototype.teardown = function () {\n        this.api.removeAllListeners();\n    };\n    return FossilDeltaSerializer;\n}());\nexports.FossilDeltaSerializer = FossilDeltaSerializer;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.END_OF_STRUCTURE = 0xc1; // (msgpack spec: never used)\nexports.NIL = 0xc0;\nexports.INDEX_CHANGE = 0xd4;\nexports.TYPE_ID = 0xd5;\n","\"use strict\";\n/**\n * Copyright (c) 2018 Endel Dreyer\n * Copyright (c) 2014 Ion Drive Software Ltd.\n *\n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n *\n * The above copyright notice and this permission notice shall be included in all\n * copies or substantial portions of the Software.\n *\n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n * SOFTWARE\n */\nObject.defineProperty(exports, \"__esModule\", { value: true });\n/**\n * msgpack implementation highly based on notepack.io\n * https://github.com/darrachequesne/notepack\n */\nfunction utf8Length(str) {\n    var c = 0, length = 0;\n    for (var i = 0, l = str.length; i < l; i++) {\n        c = str.charCodeAt(i);\n        if (c < 0x80) {\n            length += 1;\n        }\n        else if (c < 0x800) {\n            length += 2;\n        }\n        else if (c < 0xd800 || c >= 0xe000) {\n            length += 3;\n        }\n        else {\n            i++;\n            length += 4;\n        }\n    }\n    return length;\n}\nfunction utf8Write(view, offset, str) {\n    var c = 0;\n    for (var i = 0, l = str.length; i < l; i++) {\n        c = str.charCodeAt(i);\n        if (c < 0x80) {\n            view[offset++] = c;\n        }\n        else if (c < 0x800) {\n            view[offset++] = 0xc0 | (c >> 6);\n            view[offset++] = 0x80 | (c & 0x3f);\n        }\n        else if (c < 0xd800 || c >= 0xe000) {\n            view[offset++] = 0xe0 | (c >> 12);\n            view[offset++] = 0x80 | (c >> 6 & 0x3f);\n            view[offset++] = 0x80 | (c & 0x3f);\n        }\n        else {\n            i++;\n            c = 0x10000 + (((c & 0x3ff) << 10) | (str.charCodeAt(i) & 0x3ff));\n            view[offset++] = 0xf0 | (c >> 18);\n            view[offset++] = 0x80 | (c >> 12 & 0x3f);\n            view[offset++] = 0x80 | (c >> 6 & 0x3f);\n            view[offset++] = 0x80 | (c & 0x3f);\n        }\n    }\n}\nexports.utf8Write = utf8Write;\nfunction int8(bytes, value) {\n    bytes.push(value);\n}\nexports.int8 = int8;\n;\nfunction uint8(bytes, value) {\n    bytes.push(value);\n}\nexports.uint8 = uint8;\n;\nfunction int16(bytes, value) {\n    bytes.push(value);\n    bytes.push(value >> 8);\n}\nexports.int16 = int16;\n;\nfunction uint16(bytes, value) {\n    bytes.push(value);\n    bytes.push(value >> 8);\n}\nexports.uint16 = uint16;\n;\nfunction int32(bytes, value) {\n    bytes.push(value);\n    bytes.push(value >> 8);\n    bytes.push(value >> 16);\n    bytes.push(value >> 24);\n}\nexports.int32 = int32;\n;\nfunction uint32(bytes, value) {\n    var b4 = value >> 24;\n    var b3 = value >> 16;\n    var b2 = value >> 8;\n    var b1 = value;\n    bytes.push(b1);\n    bytes.push(b2);\n    bytes.push(b3);\n    bytes.push(b4);\n}\nexports.uint32 = uint32;\n;\nfunction int64(bytes, value) {\n    var high = Math.floor(value / Math.pow(2, 32));\n    var low = value >>> 0;\n    uint32(bytes, low);\n    uint32(bytes, high);\n}\nexports.int64 = int64;\n;\nfunction uint64(bytes, value) {\n    var high = (value / Math.pow(2, 32)) >> 0;\n    var low = value >>> 0;\n    uint32(bytes, low);\n    uint32(bytes, high);\n}\nexports.uint64 = uint64;\n;\nfunction float32(bytes, value) {\n    writeFloat32(bytes, value);\n}\nexports.float32 = float32;\nfunction float64(bytes, value) {\n    writeFloat64(bytes, value);\n}\nexports.float64 = float64;\n// force little endian to facilitate decoding on multiple implementations\nvar _isLittleEndian = true; // new Uint16Array(new Uint8Array([1, 0]).buffer)[0] === 1;\nvar _int32 = new Int32Array(2);\nvar _float32 = new Float32Array(_int32.buffer);\nvar _float64 = new Float64Array(_int32.buffer);\nfunction writeFloat32(bytes, value) {\n    _float32[0] = value;\n    int32(bytes, _int32[0]);\n}\nexports.writeFloat32 = writeFloat32;\n;\nfunction writeFloat64(bytes, value) {\n    _float64[0] = value;\n    int32(bytes, _int32[_isLittleEndian ? 0 : 1]);\n    int32(bytes, _int32[_isLittleEndian ? 1 : 0]);\n}\nexports.writeFloat64 = writeFloat64;\n;\nfunction boolean(bytes, value) {\n    return uint8(bytes, value ? 1 : 0);\n}\nexports.boolean = boolean;\n;\nfunction string(bytes, value) {\n    // encode `null` strings as empty.\n    if (!value) {\n        value = \"\";\n    }\n    var length = utf8Length(value);\n    var size = 0;\n    // fixstr\n    if (length < 0x20) {\n        bytes.push(length | 0xa0);\n        size = 1;\n    }\n    // str 8\n    else if (length < 0x100) {\n        bytes.push(0xd9);\n        uint8(bytes, length);\n        size = 2;\n    }\n    // str 16\n    else if (length < 0x10000) {\n        bytes.push(0xda);\n        uint16(bytes, length);\n        size = 3;\n    }\n    // str 32\n    else if (length < 0x100000000) {\n        bytes.push(0xdb);\n        uint32(bytes, length);\n        size = 5;\n    }\n    else {\n        throw new Error('String too long');\n    }\n    utf8Write(bytes, bytes.length, value);\n    return size + length;\n}\nexports.string = string;\nfunction number(bytes, value) {\n    if (isNaN(value)) {\n        return number(bytes, 0);\n    }\n    else if (!isFinite(value)) {\n        return number(bytes, (value > 0) ? Number.MAX_SAFE_INTEGER : -Number.MAX_SAFE_INTEGER);\n    }\n    else if (value !== (value | 0)) {\n        bytes.push(0xcb);\n        writeFloat64(bytes, value);\n        return 9;\n        // TODO: encode float 32?\n        // is it possible to differentiate between float32 / float64 here?\n        // // float 32\n        // bytes.push(0xca);\n        // writeFloat32(bytes, value);\n        // return 5;\n    }\n    if (value >= 0) {\n        // positive fixnum\n        if (value < 0x80) {\n            uint8(bytes, value);\n            return 1;\n        }\n        // uint 8\n        if (value < 0x100) {\n            bytes.push(0xcc);\n            uint8(bytes, value);\n            return 2;\n        }\n        // uint 16\n        if (value < 0x10000) {\n            bytes.push(0xcd);\n            uint16(bytes, value);\n            return 3;\n        }\n        // uint 32\n        if (value < 0x100000000) {\n            bytes.push(0xce);\n            uint32(bytes, value);\n            return 5;\n        }\n        // uint 64\n        bytes.push(0xcf);\n        uint64(bytes, value);\n        return 9;\n    }\n    else {\n        // negative fixnum\n        if (value >= -0x20) {\n            bytes.push(value);\n            return 1;\n        }\n        // int 8\n        if (value >= -0x80) {\n            bytes.push(0xd0);\n            int8(bytes, value);\n            return 2;\n        }\n        // int 16\n        if (value >= -0x8000) {\n            bytes.push(0xd1);\n            int16(bytes, value);\n            return 3;\n        }\n        // int 32\n        if (value >= -0x80000000) {\n            bytes.push(0xd2);\n            int32(bytes, value);\n            return 5;\n        }\n        // int 64\n        bytes.push(0xd3);\n        int64(bytes, value);\n        return 9;\n    }\n}\nexports.number = number;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar spec_1 = require(\"../spec\");\nfunction utf8Read(bytes, offset, length) {\n    var string = '', chr = 0;\n    for (var i = offset, end = offset + length; i < end; i++) {\n        var byte = bytes[i];\n        if ((byte & 0x80) === 0x00) {\n            string += String.fromCharCode(byte);\n            continue;\n        }\n        if ((byte & 0xe0) === 0xc0) {\n            string += String.fromCharCode(((byte & 0x1f) << 6) |\n                (bytes[++i] & 0x3f));\n            continue;\n        }\n        if ((byte & 0xf0) === 0xe0) {\n            string += String.fromCharCode(((byte & 0x0f) << 12) |\n                ((bytes[++i] & 0x3f) << 6) |\n                ((bytes[++i] & 0x3f) << 0));\n            continue;\n        }\n        if ((byte & 0xf8) === 0xf0) {\n            chr = ((byte & 0x07) << 18) |\n                ((bytes[++i] & 0x3f) << 12) |\n                ((bytes[++i] & 0x3f) << 6) |\n                ((bytes[++i] & 0x3f) << 0);\n            if (chr >= 0x010000) { // surrogate pair\n                chr -= 0x010000;\n                string += String.fromCharCode((chr >>> 10) + 0xD800, (chr & 0x3FF) + 0xDC00);\n            }\n            else {\n                string += String.fromCharCode(chr);\n            }\n            continue;\n        }\n        throw new Error('Invalid byte ' + byte.toString(16));\n    }\n    return string;\n}\nfunction int8(bytes, it) {\n    return uint8(bytes, it) << 24 >> 24;\n}\nexports.int8 = int8;\n;\nfunction uint8(bytes, it) {\n    return bytes[it.offset++];\n}\nexports.uint8 = uint8;\n;\nfunction int16(bytes, it) {\n    return uint16(bytes, it) << 16 >> 16;\n}\nexports.int16 = int16;\n;\nfunction uint16(bytes, it) {\n    return bytes[it.offset++] | bytes[it.offset++] << 8;\n}\nexports.uint16 = uint16;\n;\nfunction int32(bytes, it) {\n    return bytes[it.offset++] | bytes[it.offset++] << 8 | bytes[it.offset++] << 16 | bytes[it.offset++] << 24;\n}\nexports.int32 = int32;\n;\nfunction uint32(bytes, it) {\n    return int32(bytes, it) >>> 0;\n}\nexports.uint32 = uint32;\n;\nfunction float32(bytes, it) {\n    return readFloat32(bytes, it);\n}\nexports.float32 = float32;\nfunction float64(bytes, it) {\n    return readFloat64(bytes, it);\n}\nexports.float64 = float64;\nfunction int64(bytes, it) {\n    var low = uint32(bytes, it);\n    var high = int32(bytes, it) * Math.pow(2, 32);\n    return high + low;\n}\nexports.int64 = int64;\n;\nfunction uint64(bytes, it) {\n    var low = uint32(bytes, it);\n    var high = uint32(bytes, it) * Math.pow(2, 32);\n    return high + low;\n}\nexports.uint64 = uint64;\n;\n// force little endian to facilitate decoding on multiple implementations\nvar _isLittleEndian = true; // new Uint16Array(new Uint8Array([1, 0]).buffer)[0] === 1;\nvar _int32 = new Int32Array(2);\nvar _float32 = new Float32Array(_int32.buffer);\nvar _float64 = new Float64Array(_int32.buffer);\nfunction readFloat32(bytes, it) {\n    _int32[0] = int32(bytes, it);\n    return _float32[0];\n}\nexports.readFloat32 = readFloat32;\n;\nfunction readFloat64(bytes, it) {\n    _int32[_isLittleEndian ? 0 : 1] = int32(bytes, it);\n    _int32[_isLittleEndian ? 1 : 0] = int32(bytes, it);\n    return _float64[0];\n}\nexports.readFloat64 = readFloat64;\n;\nfunction boolean(bytes, it) {\n    return uint8(bytes, it) > 0;\n}\nexports.boolean = boolean;\n;\nfunction string(bytes, it) {\n    var prefix = bytes[it.offset++];\n    var length;\n    if (prefix < 0xc0) {\n        // fixstr\n        length = prefix & 0x1f;\n    }\n    else if (prefix === 0xd9) {\n        length = uint8(bytes, it);\n    }\n    else if (prefix === 0xda) {\n        length = uint16(bytes, it);\n    }\n    else if (prefix === 0xdb) {\n        length = uint32(bytes, it);\n    }\n    var value = utf8Read(bytes, it.offset, length);\n    it.offset += length;\n    return value;\n}\nexports.string = string;\nfunction stringCheck(bytes, it) {\n    var prefix = bytes[it.offset];\n    return (\n    // fixstr\n    (prefix < 0xc0 && prefix > 0xa0) ||\n        // str 8\n        prefix === 0xd9 ||\n        // str 16\n        prefix === 0xda ||\n        // str 32\n        prefix === 0xdb);\n}\nexports.stringCheck = stringCheck;\nfunction number(bytes, it) {\n    var prefix = bytes[it.offset++];\n    if (prefix < 0x80) {\n        // positive fixint\n        return prefix;\n    }\n    else if (prefix === 0xca) {\n        // float 32\n        return readFloat32(bytes, it);\n    }\n    else if (prefix === 0xcb) {\n        // float 64\n        return readFloat64(bytes, it);\n    }\n    else if (prefix === 0xcc) {\n        // uint 8\n        return uint8(bytes, it);\n    }\n    else if (prefix === 0xcd) {\n        // uint 16\n        return uint16(bytes, it);\n    }\n    else if (prefix === 0xce) {\n        // uint 32\n        return uint32(bytes, it);\n    }\n    else if (prefix === 0xcf) {\n        // uint 64\n        return uint64(bytes, it);\n    }\n    else if (prefix === 0xd0) {\n        // int 8\n        return int8(bytes, it);\n    }\n    else if (prefix === 0xd1) {\n        // int 16\n        return int16(bytes, it);\n    }\n    else if (prefix === 0xd2) {\n        // int 32\n        return int32(bytes, it);\n    }\n    else if (prefix === 0xd3) {\n        // int 64\n        return int64(bytes, it);\n    }\n    else if (prefix > 0xdf) {\n        // negative fixint\n        return (0xff - prefix + 1) * -1;\n    }\n}\nexports.number = number;\n;\nfunction numberCheck(bytes, it) {\n    var prefix = bytes[it.offset];\n    // positive fixint - 0x00 - 0x7f\n    // float 32        - 0xca\n    // float 64        - 0xcb\n    // uint 8          - 0xcc\n    // uint 16         - 0xcd\n    // uint 32         - 0xce\n    // uint 64         - 0xcf\n    // int 8           - 0xd0\n    // int 16          - 0xd1\n    // int 32          - 0xd2\n    // int 64          - 0xd3\n    return (prefix < 0x80 ||\n        (prefix >= 0xca && prefix <= 0xd3));\n}\nexports.numberCheck = numberCheck;\nfunction arrayCheck(bytes, it) {\n    return bytes[it.offset] < 0xa0;\n    // const prefix = bytes[it.offset] ;\n    // if (prefix < 0xa0) {\n    //   return prefix;\n    // // array\n    // } else if (prefix === 0xdc) {\n    //   it.offset += 2;\n    // } else if (0xdd) {\n    //   it.offset += 4;\n    // }\n    // return prefix;\n}\nexports.arrayCheck = arrayCheck;\nfunction nilCheck(bytes, it) {\n    return bytes[it.offset] === spec_1.NIL;\n}\nexports.nilCheck = nilCheck;\nfunction indexChangeCheck(bytes, it) {\n    return bytes[it.offset] === spec_1.INDEX_CHANGE;\n}\nexports.indexChangeCheck = indexChangeCheck;\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar ArraySchema = /** @class */ (function (_super) {\n    __extends(ArraySchema, _super);\n    // static get [Symbol.species](): any { return ArraySchema; }\n    function ArraySchema() {\n        var items = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            items[_i] = arguments[_i];\n        }\n        var _this = _super.apply(this, items) || this;\n        Object.setPrototypeOf(_this, Object.create(ArraySchema.prototype));\n        Object.defineProperties(_this, {\n            $sorting: { value: undefined, enumerable: false, writable: true },\n            $changes: { value: undefined, enumerable: false, writable: true },\n            onAdd: { value: undefined, enumerable: false, writable: true },\n            onRemove: { value: undefined, enumerable: false, writable: true },\n            onChange: { value: undefined, enumerable: false, writable: true },\n            triggerAll: {\n                value: function () {\n                    if (!_this.onAdd) {\n                        return;\n                    }\n                    for (var i = 0; i < _this.length; i++) {\n                        _this.onAdd(_this[i], i);\n                    }\n                }\n            },\n            toJSON: {\n                value: function () {\n                    var arr = [];\n                    for (var i = 0; i < _this.length; i++) {\n                        var objAt = _this[i];\n                        arr.push((typeof (objAt.toJSON) === \"function\")\n                            ? objAt.toJSON()\n                            : objAt);\n                    }\n                    return arr;\n                }\n            },\n            clone: {\n                value: function (isDecoding) {\n                    var cloned;\n                    if (isDecoding) {\n                        cloned = new (ArraySchema.bind.apply(ArraySchema, [void 0].concat(_this)))();\n                        cloned.onAdd = _this.onAdd;\n                        cloned.onRemove = _this.onRemove;\n                        cloned.onChange = _this.onChange;\n                    }\n                    else {\n                        cloned = new (ArraySchema.bind.apply(ArraySchema, [void 0].concat(_this.map(function (item) {\n                            if (typeof (item) === \"object\") {\n                                return item.clone();\n                            }\n                            else {\n                                return item;\n                            }\n                        }))))();\n                    }\n                    return cloned;\n                }\n            }\n        });\n        return _this;\n    }\n    ArraySchema.prototype.sort = function (compareFn) {\n        this.$sorting = true;\n        _super.prototype.sort.call(this, compareFn);\n        var changes = this.$changes.changes;\n        for (var _i = 0, changes_1 = changes; _i < changes_1.length; _i++) {\n            var key = changes_1[_i];\n            // track index change\n            var previousIndex = this.$changes.getIndex(this[key]);\n            if (previousIndex !== undefined) {\n                this.$changes.mapIndexChange(this[key], previousIndex);\n            }\n            this.$changes.mapIndex(this[key], key);\n        }\n        this.$sorting = false;\n        return this;\n    };\n    ArraySchema.prototype.filter = function (callbackfn, thisArg) {\n        var filtered = _super.prototype.filter.call(this, callbackfn);\n        // TODO: apply removed items on $changes\n        filtered.$changes = this.$changes;\n        return filtered;\n    };\n    ArraySchema.prototype.splice = function (start, deleteCount) {\n        var insert = [];\n        for (var _i = 2; _i < arguments.length; _i++) {\n            insert[_i - 2] = arguments[_i];\n        }\n        var removedItems = Array.prototype.splice.apply(this, arguments);\n        var movedItems = Array.prototype.filter.call(this, function (item, idx) {\n            return idx >= start + deleteCount - 1;\n        });\n        removedItems.map(function (removedItem) {\n            // If the removed item is a schema we need to update it.\n            if (removedItem && removedItem.$changes) {\n                removedItem.$changes.parent.deleteIndex(removedItem);\n                removedItem.$changes.parent.deleteIndexChange(removedItem);\n                delete removedItem.$changes.parent;\n            }\n        });\n        movedItems.forEach(function (movedItem) {\n            // If the moved item is a schema we need to update it.\n            if (movedItem && movedItem.$changes) {\n                movedItem.$changes.parentField--;\n            }\n        });\n        return removedItems;\n    };\n    return ArraySchema;\n}(Array));\nexports.ArraySchema = ArraySchema;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar MapSchema = /** @class */ (function () {\n    function MapSchema(obj) {\n        var _this = this;\n        if (obj === void 0) { obj = {}; }\n        for (var key in obj) {\n            this[key] = obj[key];\n        }\n        Object.defineProperties(this, {\n            $changes: { value: undefined, enumerable: false, writable: true },\n            onAdd: { value: undefined, enumerable: false, writable: true },\n            onRemove: { value: undefined, enumerable: false, writable: true },\n            onChange: { value: undefined, enumerable: false, writable: true },\n            clone: {\n                value: function (isDecoding) {\n                    var cloned;\n                    if (isDecoding) {\n                        // client-side\n                        cloned = Object.assign(new MapSchema(), _this);\n                        cloned.onAdd = _this.onAdd;\n                        cloned.onRemove = _this.onRemove;\n                        cloned.onChange = _this.onChange;\n                    }\n                    else {\n                        // server-side\n                        var cloned_1 = new MapSchema();\n                        for (var key in _this) {\n                            if (typeof (_this[key]) === \"object\") {\n                                cloned_1[key] = _this[key].clone();\n                            }\n                            else {\n                                cloned_1[key] = _this[key];\n                            }\n                        }\n                    }\n                    return cloned;\n                }\n            },\n            triggerAll: {\n                value: function () {\n                    if (!_this.onAdd) {\n                        return;\n                    }\n                    for (var key in _this) {\n                        _this.onAdd(_this[key], key);\n                    }\n                }\n            },\n            toJSON: {\n                value: function () {\n                    var map = {};\n                    for (var key in _this) {\n                        map[key] = (typeof (_this[key].toJSON) === \"function\")\n                            ? _this[key].toJSON()\n                            : _this[key];\n                    }\n                    return map;\n                }\n            },\n            _indexes: { value: new Map(), enumerable: false, writable: true },\n            _updateIndexes: {\n                value: function () {\n                    var index = 0;\n                    var indexes = new Map();\n                    for (var key in _this) {\n                        indexes.set(key, index++);\n                    }\n                    _this._indexes = indexes;\n                }\n            },\n        });\n    }\n    return MapSchema;\n}());\nexports.MapSchema = MapSchema;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Schema_1 = require(\"./Schema\");\nvar ArraySchema_1 = require(\"./types/ArraySchema\");\nvar MapSchema_1 = require(\"./types/MapSchema\");\nvar ChangeTree = /** @class */ (function () {\n    function ChangeTree(parentField, parent, trackAllChanges) {\n        if (parentField === void 0) { parentField = null; }\n        if (trackAllChanges === void 0) { trackAllChanges = false; }\n        this.changed = false;\n        this.changes = [];\n        this.allChanges = [];\n        this.deletedKeys = {};\n        this.linkedTrees = [];\n        this.parent = parent;\n        this.parentField = parentField;\n        this.trackAllChanges = trackAllChanges;\n    }\n    ChangeTree.prototype.link = function (linkedTree) {\n        this.linkedTrees.push(linkedTree);\n    };\n    ChangeTree.prototype.change = function (field, isDelete) {\n        if (isDelete === void 0) { isDelete = false; }\n        this.changed = true;\n        if (this.changes.indexOf(field) === -1) {\n            this.changes.push(field);\n        }\n        var allChangesIndex = this.allChanges.indexOf(field);\n        if (!isDelete && allChangesIndex === -1) {\n            this.allChanges.push(field);\n        }\n        else if (isDelete && allChangesIndex >= 0) {\n            // discard all-changes for removed items.\n            this.allChanges.splice(allChangesIndex, 1);\n        }\n        if (this.parent) {\n            this.parent.change(this.parentField);\n        }\n    };\n    ChangeTree.prototype.mapIndex = function (instance, key) {\n        if (typeof instance === \"object\") {\n            if (!this.indexMap) {\n                this.indexMap = new Map();\n                this.indexChange = new Map();\n            }\n            this.indexMap.set(instance, key);\n        }\n    };\n    ChangeTree.prototype.getIndex = function (instance) {\n        return this.indexMap && this.indexMap.get(instance);\n    };\n    ChangeTree.prototype.deleteIndex = function (instance) {\n        this.deletedKeys[this.indexMap.get(instance)] = true;\n        this.indexMap.delete(instance);\n    };\n    ChangeTree.prototype.isDeleted = function (key) {\n        return this.deletedKeys[key] !== undefined;\n    };\n    ChangeTree.prototype.mapIndexChange = function (instance, key) {\n        if (typeof instance === \"object\") {\n            this.indexChange.set(instance, key);\n        }\n    };\n    ChangeTree.prototype.getIndexChange = function (instance) {\n        return this.indexChange && this.indexChange.get(instance);\n    };\n    ChangeTree.prototype.deleteIndexChange = function (instance) {\n        this.indexChange.delete(instance);\n    };\n    ChangeTree.prototype.changeAll = function (obj) {\n        if (obj instanceof Schema_1.Schema) {\n            var schema = obj._schema;\n            for (var field in schema) {\n                // ensure ArraySchema and MapSchema already initialized\n                // on its structure have a valid parent.\n                if ((obj[field] instanceof Schema_1.Schema ||\n                    obj[field] instanceof ArraySchema_1.ArraySchema ||\n                    obj[field] instanceof MapSchema_1.MapSchema) &&\n                    !obj[field].$changes.parent.parent) {\n                    obj[field].$changes.parent = this;\n                }\n                this.change(field);\n            }\n        }\n        else {\n            var keys = Object.keys(obj);\n            for (var _i = 0, keys_1 = keys; _i < keys_1.length; _i++) {\n                var key = keys_1[_i];\n                this.change(key);\n            }\n        }\n    };\n    ChangeTree.prototype.discard = function () {\n        this.changed = false;\n        this.changes = [];\n        this.deletedKeys = {};\n        if (this.indexChange) {\n            this.indexChange.clear();\n        }\n    };\n    return ChangeTree;\n}());\nexports.ChangeTree = ChangeTree;\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar spec_1 = require(\"./spec\");\nvar encode = require(\"./encoding/encode\");\nvar decode = require(\"./encoding/decode\");\nvar ArraySchema_1 = require(\"./types/ArraySchema\");\nvar MapSchema_1 = require(\"./types/MapSchema\");\nvar ChangeTree_1 = require(\"./ChangeTree\");\nvar EncodeSchemaError = /** @class */ (function (_super) {\n    __extends(EncodeSchemaError, _super);\n    function EncodeSchemaError() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    return EncodeSchemaError;\n}(Error));\nfunction assertType(value, type, klass, field) {\n    var typeofTarget;\n    var allowNull = false;\n    switch (type) {\n        case \"number\":\n        case \"int8\":\n        case \"uint8\":\n        case \"int16\":\n        case \"uint16\":\n        case \"int32\":\n        case \"uint32\":\n        case \"int64\":\n        case \"uint64\":\n        case \"float32\":\n        case \"float64\":\n            typeofTarget = \"number\";\n            if (isNaN(value)) {\n                console.log(\"trying to encode \\\"NaN\\\" in \" + klass.constructor.name + \"#\" + field);\n            }\n            break;\n        case \"string\":\n            typeofTarget = \"string\";\n            allowNull = true;\n            break;\n        case \"boolean\":\n            // boolean is always encoded as true/false based on truthiness\n            return;\n    }\n    if (typeof (value) !== typeofTarget && (!allowNull || (allowNull && value !== null))) {\n        var foundValue = \"'\" + JSON.stringify(value) + \"'\" + (value && value.constructor && \" (\" + value.constructor.name + \")\");\n        throw new EncodeSchemaError(\"a '\" + typeofTarget + \"' was expected, but \" + foundValue + \" was provided in \" + klass.constructor.name + \"#\" + field);\n    }\n}\nfunction assertInstanceType(value, type, klass, field) {\n    if (!(value instanceof type)) {\n        throw new EncodeSchemaError(\"a '\" + type.name + \"' was expected, but '\" + value.constructor.name + \"' was provided in \" + klass.constructor.name + \"#\" + field);\n    }\n}\nfunction encodePrimitiveType(type, bytes, value, klass, field) {\n    var encodeFunc = encode[type];\n    if (value === undefined) {\n        bytes.push(spec_1.NIL);\n    }\n    else {\n        assertType(value, type, klass, field);\n    }\n    if (encodeFunc) {\n        encodeFunc(bytes, value);\n        return true;\n    }\n    else {\n        return false;\n    }\n}\nfunction decodePrimitiveType(type, bytes, it) {\n    var decodeFunc = decode[type];\n    if (decodeFunc) {\n        return decodeFunc(bytes, it);\n    }\n    else {\n        return null;\n    }\n}\n/**\n * Schema encoder / decoder\n */\nvar Schema = /** @class */ (function () {\n    // allow inherited classes to have a constructor\n    function Schema() {\n        var args = [];\n        for (var _i = 0; _i < arguments.length; _i++) {\n            args[_i] = arguments[_i];\n        }\n        // fix enumerability of fields for end-user\n        Object.defineProperties(this, {\n            $changes: { value: new ChangeTree_1.ChangeTree(), enumerable: false, writable: true },\n        });\n        var descriptors = this._descriptors;\n        if (descriptors) {\n            Object.defineProperties(this, descriptors);\n        }\n    }\n    Schema.onError = function (e) {\n        console.error(e);\n    };\n    Object.defineProperty(Schema.prototype, \"_schema\", {\n        get: function () { return this.constructor._schema; },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Schema.prototype, \"_descriptors\", {\n        get: function () { return this.constructor._descriptors; },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Schema.prototype, \"_indexes\", {\n        get: function () { return this.constructor._indexes; },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Schema.prototype, \"_filters\", {\n        get: function () { return this.constructor._filters; },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(Schema.prototype, \"$changed\", {\n        get: function () { return this.$changes.changed; },\n        enumerable: true,\n        configurable: true\n    });\n    Schema.prototype.decode = function (bytes, it) {\n        if (it === void 0) { it = { offset: 0 }; }\n        var changes = [];\n        var schema = this._schema;\n        var indexes = this._indexes;\n        var fieldsByIndex = {};\n        Object.keys(indexes).forEach(function (key) {\n            var value = indexes[key];\n            fieldsByIndex[value] = key;\n        });\n        var totalBytes = bytes.length;\n        // skip TYPE_ID of existing instances\n        if (bytes[it.offset] === spec_1.TYPE_ID) {\n            it.offset += 2;\n        }\n        var _loop_1 = function () {\n            var index = bytes[it.offset++];\n            if (index === spec_1.END_OF_STRUCTURE) {\n                return \"break\";\n            }\n            var field = fieldsByIndex[index];\n            var type = schema[field];\n            var value = void 0;\n            var change = void 0; // for triggering onChange\n            var hasChange = false;\n            if (type._schema) {\n                if (decode.nilCheck(bytes, it)) {\n                    it.offset++;\n                    value = null;\n                }\n                else {\n                    value = this_1[\"_\" + field] || this_1.createTypeInstance(bytes, it, type);\n                    value.decode(bytes, it);\n                }\n                hasChange = true;\n            }\n            else if (Array.isArray(type)) {\n                type = type[0];\n                change = [];\n                var valueRef_1 = this_1[\"_\" + field] || new ArraySchema_1.ArraySchema();\n                value = valueRef_1.clone(true);\n                var newLength_1 = decode.number(bytes, it);\n                var numChanges = Math.min(decode.number(bytes, it), newLength_1);\n                hasChange = (numChanges > 0);\n                // FIXME: this may not be reliable. possibly need to encode this variable during\n                // serializagion\n                var hasIndexChange = false;\n                // ensure current array has the same length as encoded one\n                if (value.length > newLength_1) {\n                    // decrease removed items from number of changes.\n                    // no need to iterate through them, as they're going to be removed.\n                    Array.prototype.splice.call(value, newLength_1).forEach(function (itemRemoved, i) {\n                        if (itemRemoved && itemRemoved.onRemove) {\n                            try {\n                                itemRemoved.onRemove();\n                            }\n                            catch (e) {\n                                Schema.onError(e);\n                            }\n                        }\n                        if (valueRef_1.onRemove) {\n                            try {\n                                valueRef_1.onRemove(itemRemoved, newLength_1 + i);\n                            }\n                            catch (e) {\n                                Schema.onError(e);\n                            }\n                        }\n                    });\n                }\n                for (var i = 0; i < numChanges; i++) {\n                    var newIndex = decode.number(bytes, it);\n                    var indexChangedFrom = void 0; // index change check\n                    if (decode.indexChangeCheck(bytes, it)) {\n                        decode.uint8(bytes, it);\n                        indexChangedFrom = decode.number(bytes, it);\n                        hasIndexChange = true;\n                    }\n                    // // Simplified method?\n                    // let isNew = (\n                    //     (value[newIndex] !== valueRef[newIndex]) ||\n                    //     (value[newIndex] === undefined && valueRef[newIndex] === undefined)\n                    // ) && indexChangedFrom === undefined;\n                    var isNew = (!hasIndexChange && value[newIndex] === undefined) || (hasIndexChange && indexChangedFrom === undefined);\n                    if (type.prototype instanceof Schema) {\n                        var item = void 0;\n                        if (isNew) {\n                            item = this_1.createTypeInstance(bytes, it, type);\n                        }\n                        else if (indexChangedFrom !== undefined) {\n                            item = valueRef_1[indexChangedFrom];\n                        }\n                        else {\n                            item = valueRef_1[newIndex];\n                        }\n                        if (!item) {\n                            item = this_1.createTypeInstance(bytes, it, type);\n                            isNew = true;\n                        }\n                        if (decode.nilCheck(bytes, it)) {\n                            it.offset++;\n                            if (valueRef_1.onRemove) {\n                                try {\n                                    valueRef_1.onRemove(item, newIndex);\n                                }\n                                catch (e) {\n                                    Schema.onError(e);\n                                }\n                            }\n                            continue;\n                        }\n                        item.decode(bytes, it);\n                        value[newIndex] = item;\n                    }\n                    else {\n                        value[newIndex] = decodePrimitiveType(type, bytes, it);\n                    }\n                    if (isNew) {\n                        if (valueRef_1.onAdd) {\n                            try {\n                                valueRef_1.onAdd(value[newIndex], newIndex);\n                            }\n                            catch (e) {\n                                Schema.onError(e);\n                            }\n                        }\n                    }\n                    else if (valueRef_1.onChange) {\n                        try {\n                            valueRef_1.onChange(value[newIndex], newIndex);\n                        }\n                        catch (e) {\n                            Schema.onError(e);\n                        }\n                    }\n                    change.push(value[newIndex]);\n                }\n            }\n            else if (type.map) {\n                type = type.map;\n                var valueRef = this_1[\"_\" + field] || new MapSchema_1.MapSchema();\n                value = valueRef.clone(true);\n                var length = decode.number(bytes, it);\n                hasChange = (length > 0);\n                // FIXME: this may not be reliable. possibly need to encode this variable during\n                // serializagion\n                var hasIndexChange = false;\n                var previousKeys = Object.keys(valueRef);\n                for (var i = 0; i < length; i++) {\n                    // `encodeAll` may indicate a higher number of indexes it actually encodes\n                    // TODO: do not encode a higher number than actual encoded entries\n                    if (bytes[it.offset] === undefined ||\n                        bytes[it.offset] === spec_1.END_OF_STRUCTURE) {\n                        break;\n                    }\n                    // index change check\n                    var previousKey = void 0;\n                    if (decode.indexChangeCheck(bytes, it)) {\n                        decode.uint8(bytes, it);\n                        previousKey = previousKeys[decode.number(bytes, it)];\n                        hasIndexChange = true;\n                    }\n                    var hasMapIndex = decode.numberCheck(bytes, it);\n                    var isSchemaType = typeof (type) !== \"string\";\n                    var newKey = (hasMapIndex)\n                        ? previousKeys[decode.number(bytes, it)]\n                        : decode.string(bytes, it);\n                    var item = void 0;\n                    var isNew = (!hasIndexChange && valueRef[newKey] === undefined) || (hasIndexChange && previousKey === undefined && hasMapIndex);\n                    if (isNew && isSchemaType) {\n                        item = this_1.createTypeInstance(bytes, it, type);\n                    }\n                    else if (previousKey !== undefined) {\n                        item = valueRef[previousKey];\n                    }\n                    else {\n                        item = valueRef[newKey];\n                    }\n                    if (decode.nilCheck(bytes, it)) {\n                        it.offset++;\n                        if (item && item.onRemove) {\n                            try {\n                                item.onRemove();\n                            }\n                            catch (e) {\n                                Schema.onError(e);\n                            }\n                        }\n                        if (valueRef.onRemove) {\n                            try {\n                                valueRef.onRemove(item, newKey);\n                            }\n                            catch (e) {\n                                Schema.onError(e);\n                            }\n                        }\n                        delete value[newKey];\n                        continue;\n                    }\n                    else if (!isSchemaType) {\n                        value[newKey] = decodePrimitiveType(type, bytes, it);\n                    }\n                    else {\n                        item.decode(bytes, it);\n                        value[newKey] = item;\n                    }\n                    if (isNew) {\n                        if (valueRef.onAdd) {\n                            try {\n                                valueRef.onAdd(value[newKey], newKey);\n                            }\n                            catch (e) {\n                                Schema.onError(e);\n                            }\n                        }\n                    }\n                    else if (valueRef.onChange) {\n                        try {\n                            valueRef.onChange(value[newKey], newKey);\n                        }\n                        catch (e) {\n                            Schema.onError(e);\n                        }\n                    }\n                }\n            }\n            else {\n                value = decodePrimitiveType(type, bytes, it);\n                hasChange = true;\n            }\n            if (hasChange && this_1.onChange) {\n                changes.push({\n                    field: field,\n                    value: change || value,\n                    previousValue: this_1[\"_\" + field]\n                });\n            }\n            this_1[\"_\" + field] = value;\n        };\n        var this_1 = this;\n        while (it.offset < totalBytes) {\n            var state_1 = _loop_1();\n            if (state_1 === \"break\")\n                break;\n        }\n        if (this.onChange && changes.length > 0) {\n            try {\n                this.onChange(changes);\n            }\n            catch (e) {\n                Schema.onError(e);\n            }\n        }\n        return this;\n    };\n    Schema.prototype.encode = function (root, encodeAll, client) {\n        var _this = this;\n        if (root === void 0) { root = this; }\n        if (encodeAll === void 0) { encodeAll = false; }\n        var encodedBytes = [];\n        // skip if nothing has changed\n        if (!this.$changes.changed && !encodeAll) {\n            this._encodeEndOfStructure(this, root, encodedBytes);\n            return encodedBytes;\n        }\n        var schema = this._schema;\n        var indexes = this._indexes;\n        var filters = this._filters;\n        var changes = (encodeAll || client)\n            ? this.$changes.allChanges\n            : this.$changes.changes;\n        var _loop_2 = function (i, l) {\n            var field = changes[i];\n            var type = schema[field];\n            var filter = (filters && filters[field]);\n            // const value = (filter && this.$allChanges[field]) || changes[field];\n            var value = this_2[\"_\" + field];\n            var fieldIndex = indexes[field];\n            // skip unchagned fields\n            if (value === undefined) {\n                return \"continue\";\n            }\n            var bytes = [];\n            if (type._schema) {\n                if (client && filter) {\n                    // skip if not allowed by custom filter\n                    if (!filter.call(this_2, client, value, root)) {\n                        return \"continue\";\n                    }\n                }\n                encode.number(bytes, fieldIndex);\n                // encode child object\n                if (value) {\n                    assertInstanceType(value, type, this_2, field);\n                    this_2.tryEncodeTypeId(bytes, type, value.constructor);\n                    bytes.push.apply(bytes, value.encode(root, encodeAll, client));\n                }\n                else {\n                    // value has been removed\n                    encode.uint8(bytes, spec_1.NIL);\n                }\n            }\n            else if (Array.isArray(type)) {\n                encode.number(bytes, fieldIndex);\n                // total of items in the array\n                encode.number(bytes, value.length);\n                var arrayChanges = ((encodeAll || client)\n                    ? value.$changes.allChanges\n                    : value.$changes.changes)\n                    .filter(function (index) { return _this[\"_\" + field][index] !== undefined; })\n                    .sort(function (a, b) { return a - b; });\n                // ensure number of changes doesn't exceed array length\n                var numChanges = arrayChanges.length;\n                // number of changed items\n                encode.number(bytes, numChanges);\n                var isChildSchema = typeof (type[0]) !== \"string\";\n                // assert ArraySchema was provided\n                assertInstanceType(this_2[\"_\" + field], ArraySchema_1.ArraySchema, this_2, field);\n                // encode Array of type\n                for (var j = 0; j < numChanges; j++) {\n                    var index = arrayChanges[j];\n                    var item = this_2[\"_\" + field][index];\n                    if (client && filter) {\n                        // skip if not allowed by custom filter\n                        if (!filter.call(this_2, client, item, root)) {\n                            continue;\n                        }\n                    }\n                    if (isChildSchema) { // is array of Schema\n                        encode.number(bytes, index);\n                        if (!encodeAll) {\n                            var indexChange = value.$changes.getIndexChange(item);\n                            if (indexChange !== undefined) {\n                                encode.uint8(bytes, spec_1.INDEX_CHANGE);\n                                encode.number(bytes, indexChange);\n                            }\n                        }\n                        assertInstanceType(item, type[0], this_2, field);\n                        this_2.tryEncodeTypeId(bytes, type[0], item.constructor);\n                        bytes.push.apply(bytes, item.encode(root, encodeAll, client));\n                    }\n                    else {\n                        encode.number(bytes, index);\n                        if (!encodePrimitiveType(type[0], bytes, item, this_2, field)) {\n                            console.log(\"cannot encode\", schema[field]);\n                            continue;\n                        }\n                    }\n                }\n                if (!encodeAll) {\n                    value.$changes.discard();\n                }\n            }\n            else if (type.map) {\n                // encode Map of type\n                encode.number(bytes, fieldIndex);\n                // TODO: during `encodeAll`, removed entries are not going to be encoded\n                var keys = (encodeAll || client)\n                    ? value.$changes.allChanges\n                    : value.$changes.changes;\n                encode.number(bytes, keys.length);\n                // const previousKeys = Object.keys(this[`_${field}`]); // this is costly!\n                var previousKeys = value.$changes.allChanges;\n                var isChildSchema = typeof (type.map) !== \"string\";\n                var numChanges = keys.length;\n                // assert MapSchema was provided\n                assertInstanceType(this_2[\"_\" + field], MapSchema_1.MapSchema, this_2, field);\n                for (var i_1 = 0; i_1 < numChanges; i_1++) {\n                    var key = (typeof (keys[i_1]) === \"number\" && previousKeys[keys[i_1]]) || keys[i_1];\n                    var item = this_2[\"_\" + field][key];\n                    var mapItemIndex = undefined;\n                    if (client && filter) {\n                        // skip if not allowed by custom filter\n                        if (!filter.call(this_2, client, item, root)) {\n                            continue;\n                        }\n                    }\n                    if (encodeAll) {\n                        if (item === undefined) {\n                            // previously deleted items are skipped during `encodeAll`\n                            continue;\n                        }\n                    }\n                    else {\n                        // encode index change\n                        var indexChange = value.$changes.getIndexChange(item);\n                        if (item && indexChange !== undefined) {\n                            encode.uint8(bytes, spec_1.INDEX_CHANGE);\n                            encode.number(bytes, this_2[\"_\" + field]._indexes.get(indexChange));\n                        }\n                        /**\n                         * - Allow item replacement\n                         * - Allow to use the index of a deleted item to encode as NIL\n                         */\n                        mapItemIndex = (!value.$changes.isDeleted(key) || !item)\n                            ? this_2[\"_\" + field]._indexes.get(key)\n                            : undefined;\n                    }\n                    if (mapItemIndex !== undefined) {\n                        encode.number(bytes, mapItemIndex);\n                    }\n                    else {\n                        encode.string(bytes, key);\n                    }\n                    if (item && isChildSchema) {\n                        assertInstanceType(item, type.map, this_2, field);\n                        this_2.tryEncodeTypeId(bytes, type.map, item.constructor);\n                        bytes.push.apply(bytes, item.encode(root, encodeAll, client));\n                    }\n                    else if (item !== undefined) {\n                        encodePrimitiveType(type.map, bytes, item, this_2, field);\n                    }\n                    else {\n                        // TODO: remove item\n                        // console.log(\"REMOVE KEY INDEX\", { key });\n                        // this[`_${field}`]._indexes.delete(key);\n                        encode.uint8(bytes, spec_1.NIL);\n                    }\n                }\n                if (!encodeAll) {\n                    value.$changes.discard();\n                    // TODO: track array/map indexes per client (for filtering)?\n                    if (!client) {\n                        // TODO: do not iterate though all MapSchema indexes here.\n                        this_2[\"_\" + field]._updateIndexes();\n                    }\n                }\n            }\n            else {\n                if (client && filter) {\n                    // skip if not allowed by custom filter\n                    if (!filter.call(this_2, client, value, root)) {\n                        return \"continue\";\n                    }\n                }\n                encode.number(bytes, fieldIndex);\n                if (!encodePrimitiveType(type, bytes, value, this_2, field)) {\n                    console.log(\"cannot encode\", schema[field]);\n                    return \"continue\";\n                }\n            }\n            encodedBytes = encodedBytes.concat(bytes);\n        };\n        var this_2 = this;\n        for (var i = 0, l = changes.length; i < l; i++) {\n            _loop_2(i, l);\n        }\n        // flag end of Schema object structure\n        this._encodeEndOfStructure(this, root, encodedBytes);\n        if (!encodeAll && !client) {\n            this.$changes.discard();\n        }\n        return encodedBytes;\n    };\n    Schema.prototype.encodeFiltered = function (client) {\n        return this.encode(this, false, client);\n    };\n    Schema.prototype.encodeAll = function () {\n        return this.encode(this, true);\n    };\n    Schema.prototype.encodeAllFiltered = function (client) {\n        return this.encode(this, true, client);\n    };\n    Schema.prototype.clone = function () {\n        var cloned = new (this.constructor);\n        var schema = this._schema;\n        for (var field in schema) {\n            if (typeof (this[field]) === \"object\" &&\n                typeof (this[field].clone) === \"function\") {\n                // deep clone\n                cloned[field] = this[field].clone();\n            }\n            else {\n                // primitive values\n                cloned[field] = this[field];\n            }\n        }\n        return cloned;\n    };\n    Schema.prototype.triggerAll = function () {\n        if (!this.onChange) {\n            return;\n        }\n        var changes = [];\n        var schema = this._schema;\n        for (var field in schema) {\n            if (this[field] !== undefined) {\n                changes.push({\n                    field: field,\n                    value: this[field],\n                    previousValue: undefined\n                });\n            }\n        }\n        try {\n            this.onChange(changes);\n        }\n        catch (e) {\n            Schema.onError(e);\n        }\n    };\n    Schema.prototype.toJSON = function () {\n        var schema = this._schema;\n        var obj = {};\n        for (var field in schema) {\n            if (this[field] !== null && typeof (this[field]) !== \"undefined\") {\n                obj[field] = (typeof (this[field].toJSON) === \"function\")\n                    ? this[field].toJSON()\n                    : this[\"_\" + field];\n            }\n        }\n        return obj;\n    };\n    Schema.prototype._encodeEndOfStructure = function (instance, root, bytes) {\n        if (instance !== root) {\n            bytes.push(spec_1.END_OF_STRUCTURE);\n        }\n    };\n    Schema.prototype.tryEncodeTypeId = function (bytes, type, targetType) {\n        if (type._typeid !== targetType._typeid) {\n            encode.uint8(bytes, spec_1.TYPE_ID);\n            encode.uint8(bytes, targetType._typeid);\n        }\n    };\n    Schema.prototype.createTypeInstance = function (bytes, it, type) {\n        if (bytes[it.offset] === spec_1.TYPE_ID) {\n            it.offset++;\n            var anotherType = this.constructor._context.get(decode.uint8(bytes, it));\n            return new anotherType();\n        }\n        else {\n            return new type();\n        }\n    };\n    return Schema;\n}());\nexports.Schema = Schema;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar ChangeTree_1 = require(\"./ChangeTree\");\nvar Schema_1 = require(\"./Schema\");\nvar Context = /** @class */ (function () {\n    function Context() {\n        this.types = {};\n        this.schemas = new Map();\n    }\n    Context.prototype.has = function (schema) {\n        return this.schemas.has(schema);\n    };\n    Context.prototype.get = function (typeid) {\n        return this.types[typeid];\n    };\n    Context.prototype.add = function (schema) {\n        schema._typeid = this.schemas.size;\n        this.types[schema._typeid] = schema;\n        this.schemas.set(schema, schema._typeid);\n    };\n    return Context;\n}());\nexports.Context = Context;\nexports.globalContext = new Context();\n/**\n * `@type()` decorator for proxies\n */\nfunction type(type, context) {\n    if (context === void 0) { context = exports.globalContext; }\n    return function (target, field) {\n        var constructor = target.constructor;\n        constructor._context = context;\n        /*\n         * static schema\n         */\n        if (!context.has(constructor)) {\n            context.add(constructor);\n            // support inheritance\n            constructor._schema = Object.assign({}, constructor._schema || {});\n            constructor._indexes = Object.assign({}, constructor._indexes || {});\n            constructor._descriptors = Object.assign({}, constructor._descriptors || {});\n        }\n        constructor._indexes[field] = Object.keys(constructor._schema).length;\n        constructor._schema[field] = type;\n        /**\n         * TODO: `isSchema` / `isArray` / `isMap` is repeated on many places!\n         * need to refactor all of them.\n         */\n        var isArray = Array.isArray(type);\n        var isMap = !isArray && type.map;\n        var isSchema = (typeof (constructor._schema[field]) === \"function\");\n        var fieldCached = \"_\" + field;\n        constructor._descriptors[fieldCached] = {\n            enumerable: false,\n            configurable: false,\n            writable: true,\n        };\n        constructor._descriptors[field] = {\n            get: function () {\n                return this[fieldCached];\n            },\n            set: function (value) {\n                /**\n                 * Create Proxy for array or map items\n                 */\n                if (isArray || isMap) {\n                    value = new Proxy(value, {\n                        get: function (obj, prop) { return obj[prop]; },\n                        set: function (obj, prop, setValue) {\n                            if (prop !== \"length\" && prop.indexOf(\"$\") !== 0) {\n                                // ensure new value has a parent\n                                var key = (isArray) ? Number(prop) : String(prop);\n                                if (!obj.$sorting) {\n                                    // track index change\n                                    var previousIndex = obj.$changes.getIndex(setValue);\n                                    if (previousIndex !== undefined) {\n                                        obj.$changes.mapIndexChange(setValue, previousIndex);\n                                    }\n                                    obj.$changes.mapIndex(setValue, key);\n                                }\n                                // if (isMap) {\n                                //     obj._indexes.delete(prop);\n                                // }\n                                if (setValue instanceof Schema_1.Schema) {\n                                    // new items are flagged with all changes\n                                    if (!setValue.$changes.parent) {\n                                        setValue.$changes = new ChangeTree_1.ChangeTree(key, obj.$changes);\n                                        setValue.$changes.changeAll(setValue);\n                                    }\n                                }\n                                else {\n                                    obj[prop] = setValue;\n                                }\n                                // apply change on ArraySchema / MapSchema\n                                obj.$changes.change(key);\n                            }\n                            else if (setValue !== obj[prop]) {\n                                // console.log(\"SET NEW LENGTH:\", setValue);\n                                // console.log(\"PREVIOUS LENGTH: \", obj[prop]);\n                            }\n                            obj[prop] = setValue;\n                            return true;\n                        },\n                        deleteProperty: function (obj, prop) {\n                            var deletedValue = obj[prop];\n                            if (isMap && deletedValue !== undefined) {\n                                obj.$changes.deleteIndex(deletedValue);\n                                obj.$changes.deleteIndexChange(deletedValue);\n                                if (deletedValue.$changes) { // deletedValue may be a primitive value\n                                    delete deletedValue.$changes.parent;\n                                }\n                                // obj._indexes.delete(prop);\n                            }\n                            delete obj[prop];\n                            var key = (isArray) ? Number(prop) : String(prop);\n                            obj.$changes.change(key, true);\n                            return true;\n                        },\n                    });\n                }\n                // skip if value is the same as cached.\n                if (value === this[fieldCached]) {\n                    return;\n                }\n                this[fieldCached] = value;\n                if (isArray) {\n                    // directly assigning an array of items as value.\n                    this.$changes.change(field);\n                    value.$changes = new ChangeTree_1.ChangeTree(field, this.$changes);\n                    for (var i = 0; i < value.length; i++) {\n                        if (value[i] instanceof Schema_1.Schema) {\n                            value[i].$changes = new ChangeTree_1.ChangeTree(i, value.$changes);\n                            value[i].$changes.changeAll(value[i]);\n                        }\n                        value.$changes.mapIndex(value[i], i);\n                        value.$changes.change(i);\n                    }\n                }\n                else if (isMap) {\n                    // directly assigning a map\n                    value.$changes = new ChangeTree_1.ChangeTree(field, this.$changes);\n                    this.$changes.change(field);\n                    for (var key in value) {\n                        if (value[key] instanceof Schema_1.Schema) {\n                            value[key].$changes = new ChangeTree_1.ChangeTree(key, value.$changes);\n                            value[key].$changes.changeAll(value[key]);\n                        }\n                        value.$changes.mapIndex(value[key], key);\n                        value.$changes.change(key);\n                    }\n                }\n                else if (isSchema) {\n                    // directly assigning a `Schema` object\n                    // value may be set to null\n                    this.$changes.change(field);\n                    if (value) {\n                        value.$changes = new ChangeTree_1.ChangeTree(field, this.$changes);\n                        value.$changes.changeAll(value);\n                    }\n                }\n                else {\n                    // directly assigning a primitive type\n                    this.$changes.change(field);\n                }\n            },\n            enumerable: true,\n            configurable: true\n        };\n    };\n}\nexports.type = type;\n/**\n * `@filter()` decorator for defining data filters per client\n */\nfunction filter(cb) {\n    return function (target, field) {\n        var constructor = target.constructor;\n        /*\n        * static filters\n        */\n        if (!constructor._filters) {\n            constructor._filters = {};\n        }\n        constructor._filters[field] = cb;\n    };\n}\nexports.filter = filter;\nfunction defineTypes(target, fields) {\n    for (var field in fields) {\n        type(fields[field])(target.prototype, field);\n    }\n    return target;\n}\nexports.defineTypes = defineTypes;\n","\"use strict\";\nvar __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar annotations_1 = require(\"./annotations\");\nvar Schema_1 = require(\"./Schema\");\nvar ArraySchema_1 = require(\"./types/ArraySchema\");\nvar MapSchema_1 = require(\"./types/MapSchema\");\nvar reflectionContext = new annotations_1.Context();\n/**\n * Reflection\n */\nvar ReflectionField = /** @class */ (function (_super) {\n    __extends(ReflectionField, _super);\n    function ReflectionField() {\n        return _super !== null && _super.apply(this, arguments) || this;\n    }\n    __decorate([\n        annotations_1.type(\"string\", reflectionContext)\n    ], ReflectionField.prototype, \"name\", void 0);\n    __decorate([\n        annotations_1.type(\"string\", reflectionContext)\n    ], ReflectionField.prototype, \"type\", void 0);\n    __decorate([\n        annotations_1.type(\"uint8\", reflectionContext)\n    ], ReflectionField.prototype, \"referencedType\", void 0);\n    return ReflectionField;\n}(Schema_1.Schema));\nexports.ReflectionField = ReflectionField;\nvar ReflectionType = /** @class */ (function (_super) {\n    __extends(ReflectionType, _super);\n    function ReflectionType() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.fields = new ArraySchema_1.ArraySchema();\n        return _this;\n    }\n    __decorate([\n        annotations_1.type(\"uint8\", reflectionContext)\n    ], ReflectionType.prototype, \"id\", void 0);\n    __decorate([\n        annotations_1.type([ReflectionField], reflectionContext)\n    ], ReflectionType.prototype, \"fields\", void 0);\n    return ReflectionType;\n}(Schema_1.Schema));\nexports.ReflectionType = ReflectionType;\nvar Reflection = /** @class */ (function (_super) {\n    __extends(Reflection, _super);\n    function Reflection() {\n        var _this = _super !== null && _super.apply(this, arguments) || this;\n        _this.types = new ArraySchema_1.ArraySchema();\n        return _this;\n    }\n    Reflection.encode = function (instance) {\n        var rootSchemaType = instance.constructor;\n        var reflection = new Reflection();\n        reflection.rootType = rootSchemaType._typeid;\n        var buildType = function (currentType, schema) {\n            for (var fieldName in schema) {\n                var field = new ReflectionField();\n                field.name = fieldName;\n                var fieldType = void 0;\n                if (typeof (schema[fieldName]) === \"string\") {\n                    fieldType = schema[fieldName];\n                }\n                else {\n                    var isSchema = typeof (schema[fieldName]) === \"function\";\n                    var isArray = Array.isArray(schema[fieldName]);\n                    var isMap = !isArray && schema[fieldName].map;\n                    var childTypeSchema = void 0;\n                    if (isSchema) {\n                        fieldType = \"ref\";\n                        childTypeSchema = schema[fieldName];\n                    }\n                    else if (isArray) {\n                        fieldType = \"array\";\n                        if (typeof (schema[fieldName][0]) === \"string\") {\n                            fieldType += \":\" + schema[fieldName][0]; // array:string\n                        }\n                        else {\n                            childTypeSchema = schema[fieldName][0];\n                        }\n                    }\n                    else if (isMap) {\n                        fieldType = \"map\";\n                        if (typeof (schema[fieldName].map) === \"string\") {\n                            fieldType += \":\" + schema[fieldName].map; // array:string\n                        }\n                        else {\n                            childTypeSchema = schema[fieldName].map;\n                        }\n                    }\n                    field.referencedType = (childTypeSchema)\n                        ? childTypeSchema._typeid\n                        : 255;\n                }\n                field.type = fieldType;\n                currentType.fields.push(field);\n            }\n            reflection.types.push(currentType);\n        };\n        var types = rootSchemaType._context.types;\n        for (var typeid in types) {\n            var type_1 = new ReflectionType();\n            type_1.id = Number(typeid);\n            buildType(type_1, types[typeid]._schema);\n        }\n        return reflection.encodeAll();\n    };\n    Reflection.decode = function (bytes) {\n        var context = new annotations_1.Context();\n        var reflection = new Reflection();\n        reflection.decode(bytes);\n        var schemaTypes = reflection.types.reduce(function (types, reflectionType) {\n            types[reflectionType.id] = /** @class */ (function (_super) {\n                __extends(_, _super);\n                function _() {\n                    return _super !== null && _super.apply(this, arguments) || this;\n                }\n                return _;\n            }(Schema_1.Schema));\n            return types;\n        }, {});\n        reflection.types.forEach(function (reflectionType, i) {\n            reflectionType.fields.forEach(function (field) {\n                var schemaType = schemaTypes[reflectionType.id];\n                if (field.referencedType !== undefined) {\n                    var refType = schemaTypes[field.referencedType];\n                    // map or array of primitive type (255)\n                    if (!refType) {\n                        refType = field.type.split(\":\")[1];\n                    }\n                    if (field.type.indexOf(\"array\") === 0) {\n                        annotations_1.type([refType], context)(schemaType.prototype, field.name);\n                    }\n                    else if (field.type.indexOf(\"map\") === 0) {\n                        annotations_1.type({ map: refType }, context)(schemaType.prototype, field.name);\n                    }\n                    else if (field.type === \"ref\") {\n                        annotations_1.type(refType, context)(schemaType.prototype, field.name);\n                    }\n                }\n                else {\n                    annotations_1.type(field.type, context)(schemaType.prototype, field.name);\n                }\n            });\n        });\n        var rootType = schemaTypes[reflection.rootType];\n        var rootInstance = new rootType();\n        /**\n         * auto-initialize referenced types on root type\n         * to allow registering listeners immediatelly on client-side\n         */\n        for (var fieldName in rootType._schema) {\n            var fieldType = rootType._schema[fieldName];\n            if (typeof (fieldType) !== \"string\") {\n                var isSchema = typeof (fieldType) === \"function\";\n                var isArray = Array.isArray(fieldType);\n                var isMap = !isArray && fieldType.map;\n                rootInstance[fieldName] = (isArray)\n                    ? new ArraySchema_1.ArraySchema()\n                    : (isMap)\n                        ? new MapSchema_1.MapSchema()\n                        : (isSchema)\n                            ? new fieldType()\n                            : undefined;\n            }\n        }\n        return rootInstance;\n    };\n    __decorate([\n        annotations_1.type([ReflectionType], reflectionContext)\n    ], Reflection.prototype, \"types\", void 0);\n    __decorate([\n        annotations_1.type(\"uint8\", reflectionContext)\n    ], Reflection.prototype, \"rootType\", void 0);\n    return Reflection;\n}(Schema_1.Schema));\nexports.Reflection = Reflection;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar Schema_1 = require(\"./Schema\");\nexports.Schema = Schema_1.Schema;\nvar MapSchema_1 = require(\"./types/MapSchema\");\nexports.MapSchema = MapSchema_1.MapSchema;\nvar ArraySchema_1 = require(\"./types/ArraySchema\");\nexports.ArraySchema = ArraySchema_1.ArraySchema;\n// Reflection\nvar Reflection_1 = require(\"./Reflection\");\nexports.Reflection = Reflection_1.Reflection;\nexports.ReflectionType = Reflection_1.ReflectionType;\nexports.ReflectionField = Reflection_1.ReflectionField;\nvar annotations_1 = require(\"./annotations\");\n// Annotations\nexports.type = annotations_1.type;\nexports.filter = annotations_1.filter;\nexports.defineTypes = annotations_1.defineTypes;\n// Types\nexports.Context = annotations_1.Context;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar schema_1 = require(\"@colyseus/schema\");\nvar SchemaSerializer = /** @class */ (function () {\n    function SchemaSerializer() {\n    }\n    SchemaSerializer.prototype.setState = function (rawState) {\n        this.state.decode(rawState);\n    };\n    SchemaSerializer.prototype.getState = function () {\n        return this.state;\n    };\n    SchemaSerializer.prototype.patch = function (patches) {\n        this.state.decode(patches);\n    };\n    SchemaSerializer.prototype.teardown = function () {\n        // this.state.onRemove\n    };\n    SchemaSerializer.prototype.handshake = function (bytes) {\n        if (this.state) {\n            // validate client/server definitinos\n            var reflection = new schema_1.Reflection();\n            reflection.decode(bytes);\n        }\n        else {\n            // initialize reflected state from server\n            this.state = schema_1.Reflection.decode(bytes);\n        }\n    };\n    return SchemaSerializer;\n}());\nexports.SchemaSerializer = SchemaSerializer;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nrequire(\"./legacy\");\nvar Client_1 = require(\"./Client\");\nexports.Client = Client_1.Client;\nvar Protocol_1 = require(\"./Protocol\");\nexports.Protocol = Protocol_1.Protocol;\nvar Room_1 = require(\"./Room\");\nexports.Room = Room_1.Room;\nvar Auth_1 = require(\"./Auth\");\nexports.Auth = Auth_1.Auth;\nexports.Platform = Auth_1.Platform;\n/*\n * Serializers\n */\nvar FossilDeltaSerializer_1 = require(\"./serializer/FossilDeltaSerializer\");\nexports.FossilDeltaSerializer = FossilDeltaSerializer_1.FossilDeltaSerializer;\nvar SchemaSerializer_1 = require(\"./serializer/SchemaSerializer\");\nexports.SchemaSerializer = SchemaSerializer_1.SchemaSerializer;\nvar Serializer_1 = require(\"./serializer/Serializer\");\nexports.registerSerializer = Serializer_1.registerSerializer;\nvar schema_1 = require(\"@colyseus/schema\");\nexports.Schema = schema_1.Schema;\nexports.type = schema_1.type;\nSerializer_1.registerSerializer('fossil-delta', FossilDeltaSerializer_1.FossilDeltaSerializer);\nSerializer_1.registerSerializer('schema', SchemaSerializer_1.SchemaSerializer);\n","import * as Colyseus from \"colyseus.js\";\n\nlet client: Colyseus.Client = new Colyseus.Client(\"ws://localhost:2567\");\n\nclient\n  .joinOrCreate(\"chat\")\n  .then((room: Colyseus.Room) => {\n    console.log(room.state);\n    room.state.onChange = changes => {\n      changes.forEach(change => {\n        console.log(change.field);\n        console.log(change.value);\n        console.log(change.previousValue);\n      });\n    };\n  })\n  .catch(e => {\n    console.log(\"JOIN ERROR\", e);\n  });\n","var OVERLAY_ID = '__parcel__error__overlay__';\n\nvar OldModule = module.bundle.Module;\n\nfunction Module(moduleName) {\n  OldModule.call(this, moduleName);\n  this.hot = {\n    data: module.bundle.hotData,\n    _acceptCallbacks: [],\n    _disposeCallbacks: [],\n    accept: function (fn) {\n      this._acceptCallbacks.push(fn || function () {});\n    },\n    dispose: function (fn) {\n      this._disposeCallbacks.push(fn);\n    }\n  };\n\n  module.bundle.hotData = null;\n}\n\nmodule.bundle.Module = Module;\nvar checkedAssets, assetsToAccept;\n\nvar parent = module.bundle.parent;\nif ((!parent || !parent.isParcelRequire) && typeof WebSocket !== 'undefined') {\n  var hostname = process.env.HMR_HOSTNAME || location.hostname;\n  var protocol = location.protocol === 'https:' ? 'wss' : 'ws';\n  var ws = new WebSocket(protocol + '://' + hostname + ':' + process.env.HMR_PORT + '/');\n  ws.onmessage = function(event) {\n    checkedAssets = {};\n    assetsToAccept = [];\n\n    var data = JSON.parse(event.data);\n\n    if (data.type === 'update') {\n      var handled = false;\n      data.assets.forEach(function(asset) {\n        if (!asset.isNew) {\n          var didAccept = hmrAcceptCheck(global.parcelRequire, asset.id);\n          if (didAccept) {\n            handled = true;\n          }\n        }\n      });\n\n      // Enable HMR for CSS by default.\n      handled = handled || data.assets.every(function(asset) {\n        return asset.type === 'css' && asset.generated.js;\n      });\n\n      if (handled) {\n        console.clear();\n\n        data.assets.forEach(function (asset) {\n          hmrApply(global.parcelRequire, asset);\n        });\n\n        assetsToAccept.forEach(function (v) {\n          hmrAcceptRun(v[0], v[1]);\n        });\n      } else {\n        window.location.reload();\n      }\n    }\n\n    if (data.type === 'reload') {\n      ws.close();\n      ws.onclose = function () {\n        location.reload();\n      }\n    }\n\n    if (data.type === 'error-resolved') {\n      console.log('[parcel]  Error resolved');\n\n      removeErrorOverlay();\n    }\n\n    if (data.type === 'error') {\n      console.error('[parcel]   ' + data.error.message + '\\n' + data.error.stack);\n\n      removeErrorOverlay();\n\n      var overlay = createErrorOverlay(data);\n      document.body.appendChild(overlay);\n    }\n  };\n}\n\nfunction removeErrorOverlay() {\n  var overlay = document.getElementById(OVERLAY_ID);\n  if (overlay) {\n    overlay.remove();\n  }\n}\n\nfunction createErrorOverlay(data) {\n  var overlay = document.createElement('div');\n  overlay.id = OVERLAY_ID;\n\n  // html encode message and stack trace\n  var message = document.createElement('div');\n  var stackTrace = document.createElement('pre');\n  message.innerText = data.error.message;\n  stackTrace.innerText = data.error.stack;\n\n  overlay.innerHTML = (\n    '<div style=\"background: black; font-size: 16px; color: white; position: fixed; height: 100%; width: 100%; top: 0px; left: 0px; padding: 30px; opacity: 0.85; font-family: Menlo, Consolas, monospace; z-index: 9999;\">' +\n      '<span style=\"background: red; padding: 2px 4px; border-radius: 2px;\">ERROR</span>' +\n      '<span style=\"top: 2px; margin-left: 5px; position: relative;\"></span>' +\n      '<div style=\"font-size: 18px; font-weight: bold; margin-top: 20px;\">' + message.innerHTML + '</div>' +\n      '<pre>' + stackTrace.innerHTML + '</pre>' +\n    '</div>'\n  );\n\n  return overlay;\n\n}\n\nfunction getParents(bundle, id) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return [];\n  }\n\n  var parents = [];\n  var k, d, dep;\n\n  for (k in modules) {\n    for (d in modules[k][1]) {\n      dep = modules[k][1][d];\n      if (dep === id || (Array.isArray(dep) && dep[dep.length - 1] === id)) {\n        parents.push(k);\n      }\n    }\n  }\n\n  if (bundle.parent) {\n    parents = parents.concat(getParents(bundle.parent, id));\n  }\n\n  return parents;\n}\n\nfunction hmrApply(bundle, asset) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n\n  if (modules[asset.id] || !bundle.parent) {\n    var fn = new Function('require', 'module', 'exports', asset.generated.js);\n    asset.isNew = !modules[asset.id];\n    modules[asset.id] = [fn, asset.deps];\n  } else if (bundle.parent) {\n    hmrApply(bundle.parent, asset);\n  }\n}\n\nfunction hmrAcceptCheck(bundle, id) {\n  var modules = bundle.modules;\n  if (!modules) {\n    return;\n  }\n\n  if (!modules[id] && bundle.parent) {\n    return hmrAcceptCheck(bundle.parent, id);\n  }\n\n  if (checkedAssets[id]) {\n    return;\n  }\n  checkedAssets[id] = true;\n\n  var cached = bundle.cache[id];\n\n  assetsToAccept.push([bundle, id]);\n\n  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {\n    return true;\n  }\n\n  return getParents(global.parcelRequire, id).some(function (id) {\n    return hmrAcceptCheck(global.parcelRequire, id)\n  });\n}\n\nfunction hmrAcceptRun(bundle, id) {\n  var cached = bundle.cache[id];\n  bundle.hotData = {};\n  if (cached) {\n    cached.hot.data = bundle.hotData;\n  }\n\n  if (cached && cached.hot && cached.hot._disposeCallbacks.length) {\n    cached.hot._disposeCallbacks.forEach(function (cb) {\n      cb(bundle.hotData);\n    });\n  }\n\n  delete bundle.cache[id];\n  bundle(id);\n\n  cached = bundle.cache[id];\n  if (cached && cached.hot && cached.hot._acceptCallbacks.length) {\n    cached.hot._acceptCallbacks.forEach(function (cb) {\n      cb();\n    });\n    return true;\n  }\n}\n"]}